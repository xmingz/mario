/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */

var TGE=TGE||{};TGE.log=function(){if(window.console){window.console.log(Array.prototype.slice.call(arguments))}};TGE.debugLog=function(){};function extend(d,b){var a=d.prototype;var c=function(){};c.prototype=b.prototype;d.prototype=new c();d.prototype.constructor=d;d.superclass=b.prototype;if(b.prototype.constructor===Object.prototype.constructor){b.prototype.constructor=b}for(var e in a){if(a.hasOwnProperty(e)){d.prototype[e]=a[e]}}}if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),d=this,b=function(){},c=function(){return d.apply(this instanceof b&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;c.prototype=new b();return c}}(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());function getElementPosition(b){var c=b;var d="";var a=0;var e=0;if(c==null){return null}while((typeof(c)=="object")&&(typeof(c.tagName)!="undefined")){e+=c.offsetTop;a+=c.offsetLeft;d=c.tagName.toUpperCase();if(d=="BODY"){c=0}if(typeof(c)=="object"){if(typeof(c.offsetParent)=="object"){c=c.offsetParent}}if(c==null){return null}}return{x:a,y:e}}function getQueryString(){var b={},d=location.search.substring(1),c=/([^&=]+)=([^&]*)/g,a;while(a=c.exec(d)){b[decodeURIComponent(a[1])]=decodeURIComponent(a[2])}return b}function getDistributionPartner(){var a=getQueryString()["dst"];return(typeof a==="string")?a:null}function loadScript(b,d){var c=document.getElementsByTagName("head")[0];var a=document.createElement("script");a.type="text/javascript";a.src=b;a.onreadystatechange=d;a.onload=d;c.appendChild(a)}TGE.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"an unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.platform=this.searchString(this.dataPlatform)||"an unknown OS or Device";this.OSversion=this.detectOSversion(this.platform);this.isMobileDevice=!(this.platform==="Windows"||this.platform==="Mac"||this.platform==="Linux");this.oniOS=this.platform==="iPhone"||this.platform==="iPad";this.onAndroid=this.platform==="Android";this.onWindowsMobile=this.platform==="Windows Phone"||this.platform==="Windows Tablet";this.usingPhoneGap=(window.PhoneGap||window.cordova||window.Cordova)},detectOSversion:function(b){var e="-1";var d="";var a=navigator.userAgent.toString();switch(b){case"Windows Phone":d=/Windows Phone OS\s+[\d\.]+/;e=String(a.match(d)).substring(17,20);break;case"iPhone":case"iPad":d=/OS\s+[\d\_]+/;e=String(a.match(d)).substring(3,6);break;case"Windows":d=/Windows NT\s+[\d\.]+/;var c=String(a.match(d)).substring(11,14);if(c=="6.1"){e="7"}else{if(c=="5.1"){e="XP"}else{if(c=="5.2"){e="XP"}else{if(c=="6.0"){e="Vista"}else{if(c=="5.01"){e="2000 SP1"}else{if(c=="5.0"){e="2000"}}}}}}break;case"Mac":d=/Mac OS X\s+[\d\_]+/;e=String(a.match(d)).substring(9,13);break;case"Android":d=/ndroid\s+[\d\.]+/;e=String(a.match(d)).substring(7,10);break}return e},searchString:function(d){for(var a=0;a<d.length;a++){if(d[a]!=null){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!==-1){return d[a].identity}}else{if(c){return d[a].identity}}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a===-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Silk",identity:"Silk",versionSearch:"Silk"},{string:navigator.userAgent,subString:"Kindle Fire",identity:"Amazon Web App",versionSearch:"AppleWebKit"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataPlatform:[{string:navigator.userAgent,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.userAgent,subString:"Tablet PC",identity:"Windows Tablet"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Silk",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"Kindle Fire",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.userAgent,subString:"Mobile",identity:"Mobile"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};TGE.BrowserDetect.init();var _vp=document.querySelector("meta[name=viewport]");if(_vp){_vp.setAttribute("content"," initial-scale=1, maximum-scale=1, user-scalable=no")}TGE.Matrix=function(h,f,k,j,g,e){h=typeof h!=="undefined"?h:1;f=typeof f!=="undefined"?f:0;k=typeof k!=="undefined"?k:0;j=typeof j!=="undefined"?j:1;g=typeof g!=="undefined"?g:0;e=typeof e!=="undefined"?e:0;this._internal=[h,k,g,f,j,e,0,0,1]};TGE.Matrix.RotationMatrix=function(b){var a=new TGE.Matrix();a._internal[0]=Math.cos(b);a._internal[1]=-Math.sin(b);a._internal[3]=Math.sin(b);a._internal[4]=Math.cos(b);return a};TGE.Matrix.ScaleMatrix=function(b,a){return new TGE.Matrix().scale(b,a)};TGE.Matrix.TranslationMatrix=function(b,a){return new TGE.Matrix().translate(b,a)};TGE.Matrix.prototype={_internal:null,identity:function(){var a=this._internal;a[1]=a[2]=a[3]=a[5]=a[6]=a[7]=0;a[0]=a[4]=a[8]=1;return this},copyFrom:function(b){var a=this._internal;var c=b._internal;a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];return this},concat:function(m){var l=this._internal;var k=m._internal;var j=l[0]*k[0]+l[1]*k[3]+l[2]*k[6];var h=l[0]*k[1]+l[1]*k[4]+l[2]*k[7];var g=l[0]*k[2]+l[1]*k[5]+l[2]*k[8];var f=l[3]*k[0]+l[4]*k[3]+l[5]*k[6];var e=l[3]*k[1]+l[4]*k[4]+l[5]*k[7];var d=l[3]*k[2]+l[4]*k[5]+l[5]*k[8];var c=l[6]*k[0]+l[7]*k[3]+l[8]*k[6];var b=l[6]*k[1]+l[7]*k[4]+l[8]*k[7];var a=l[6]*k[2]+l[7]*k[5]+l[8]*k[8];l[0]=j;l[1]=h;l[2]=g;l[3]=f;l[4]=e;l[5]=d;l[6]=c;l[7]=b;l[8]=a;return this},rotate:function(a){return this.concat(TGE.Matrix.RotationMatrix(a*TGE.DEG2RAD))},scale:function(c,b){var a=this._internal;a[0]*=c;a[1]*=b;a[3]*=c;a[4]*=b;return this},translate:function(b,a){this._internal[2]+=b;this._internal[5]+=a;return this},transformPoint:function(b){var a=b.x;var c=b.y;b.x=a*this._internal[0]+c*this._internal[1]+this._internal[2];b.y=a*this._internal[3]+c*this._internal[4]+this._internal[5];return b}};TGE.Point=function(a,b){a=typeof a!=="undefined"?a:0;b=typeof b!=="undefined"?b:0;this.x=a;this.y=b;return this};TGE.Point.prototype={setTo:function(a,b){this.x=a;this.y=b},copyFrom:function(a){this.x=a.x;this.y=a.y;return this},add:function(a){return new this.constructor(this.x+a.x,this.y+a.y)},subtract:function(a){return new this.constructor(this.x-a.x,this.y-a.y)},offset:function(b,a){this.x+=b;this.y+=a;return this},rotate:function(b){var a=b*TGE.DEG2RAD;return new this.constructor(this.x*Math.cos(a)-this.y*Math.sin(a),this.y*Math.cos(a)+this.x*Math.sin(a))},rotateThis:function(d){var c=d*TGE.DEG2RAD;var a=this.x*Math.cos(c)-this.y*Math.sin(c);var b=this.y*Math.cos(c)+this.x*Math.sin(c);this.setTo(a,b);return this}};TGE.Vector2D=function(a,b){TGE.Vector2D.superclass.constructor.call(this,a,b)};TGE.Vector2D.prototype={magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dotProduct:function(a){return this.x*a.x+this.y*a.y},crossProduct:function(a){return this.x*a.y-this.y*a.x},angleBetween:function(a){var b=this.magnitude()*a.magnitude();if(b===0){return 0}return Math.acos(this.dotProduct(a)/b)*TGE.RAD2DEG}};extend(TGE.Vector2D,TGE.Point);TGE.Rectangle=function(b,d,c,a){b=typeof b!=="undefined"?b:0;d=typeof d!=="undefined"?d:0;c=typeof c!=="undefined"?c:0;a=typeof a!=="undefined"?a:0;this.x=b;this.y=d;this.width=c;this.height=a};TGE.Rectangle.prototype={intersects:function(h,l,j){l=typeof l==="undefined"?1:l;j=typeof j==="undefined"?1:j;var n=this.width*(1-l)/2;var m=this.height*(1-l)/2;var k=this.x+n;var g=this.y+m;var d=this.x+this.width-n;var c=this.y+this.height-m;n=h.width*(1-j)/2;m=h.height*(1-j)/2;var f=h.x+n;var e=h.y+m;var b=h.x+h.width-n;var a=h.y+h.height-m;if(f>=k&&b<=d&&e>=g&&a<=c){return true}if((d<f||k>b)||(c<e||g>a)){return false}return true},union:function(a){var g=this.x+this.width;var f=this.y+this.height;var c=a.x+a.width;var b=a.y+a.height;this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);var e=Math.max(g,c);var d=Math.max(f,b);this.width=e-this.x;this.height=d-this.y}};TGE.PI=3.1415926535;TGE.TWO_PI=6.2831853072;TGE.RAD2DEG=57.2957795;TGE.DEG2RAD=0.0174532925;TGE.POSITIVE_X_VECTOR=new TGE.Vector2D(1,0);TGE.NEGATIVE_X_VECTOR=new TGE.Vector2D(-1,0);TGE.POSITIVE_Y_VECTOR=new TGE.Vector2D(0,1);TGE.NEGATIVE_Y_VECTOR=new TGE.Vector2D(0,-1);TGE.DisplayObject=function(){this.x=0;this.y=0;this.worldX=0;this.worldY=0;this.scaleX=1;this.scaleY=1;this.rotation=0;this.alpha=1;this.backgroundColor=null;this.visible=true;this.width=0;this.height=0;this.registrationX=TGE.DisplayObject.DefaultRegistrationX;this.registrationY=TGE.DisplayObject.DefaultRegistrationY;this.parent=null;this.stage=null;this.mouseEnabled=false;this.mouseX=0;this.mouseY=0;this.instanceName="";this._mPreviousX=0;this._mPreviousY=0;this._mPreviousScaleX=1;this._mPreviousScaleY=1;this._mPreviousRotation=0;this._mPreviousRegistrationX=0;this._mPreviousRegistrationY=0;this._mPreviousWidth=0;this._mPreviousHeight=0;this._mPreviousVisibility=false;this._mLocalTransform=new TGE.Matrix();this._mLocalTransformNoReg=new TGE.Matrix();this._mLocalTransformDirty=true;this._mWorldTransform=new TGE.Matrix();this._mWorldTransformNoReg=new TGE.Matrix();this._mWorldTransformDirty=true;this._mRegistrationTransform=new TGE.Matrix();this._mTopLeft=new TGE.Point();this._mTopRight=new TGE.Point();this._mBottomLeft=new TGE.Point();this._mBottomRight=new TGE.Point();this._mAABB=new TGE.Rectangle();this._mBoundingInfoDirty=true;this._mWorldAlpha=1;this._mIgnoreProperties=false;this._mMouseOver=false;this._mVisibilityChanged=false;this._mMarkedForRemoval=false;this._mEventListeners={};this._mViewportCulling=null;this._mWorldPositionListener=-1;return this};TGE.DisplayObject.DefaultRegistrationX=0.5;TGE.DisplayObject.DefaultRegistrationY=0.5;TGE.DisplayObject._sNextEventListenerID=0;TGE.DisplayObject.prototype={setup:function(a){typeof(a.instanceName)==="string"?this.instanceName=a.instanceName:null;typeof(a.visible)==="boolean"?this.visible=a.visible:null;typeof(a.x)==="number"?this.x=a.x:null;typeof(a.y)==="number"?this.y=a.y:null;typeof(a.worldX)==="number"?this.worldX=a.worldX:null;typeof(a.worldY)==="number"?this.worldY=a.worldY:null;typeof(a.width)==="number"?this.width=a.width:null;typeof(a.height)==="number"?this.height=a.height:null;typeof(a.scaleX)==="number"?this.scaleX=a.scaleX:null;typeof(a.scaleY)==="number"?this.scaleY=a.scaleY:null;typeof(a.scale)==="number"?this.scaleX=this.scaleY=a.scale:null;typeof(a.rotation)==="number"?this.rotation=a.rotation:null;typeof(a.backgroundColor)==="string"?this.backgroundColor=a.backgroundColor:null;typeof(a.alpha)==="number"?this.alpha=a.alpha:null;typeof(a.registrationX)==="number"?this.registrationX=a.registrationX:null;typeof(a.registrationY)==="number"?this.registrationY=a.registrationY:null;typeof(a.parent)!=="undefined"?a.parent.addChild(this):null;return this},setLocalTransform:function(j,g,l,k,h,f){var e=this._mLocalTransform._internal;e[0]=j;e[1]=l;e[2]=h;e[3]=g;e[4]=k;e[5]=f;this._mIgnoreProperties=true;this._mLocalTransformDirty=true},useDisplayProperties:function(){this._mIgnoreProperties=false;this._mLocalTransformDirty=true},getBounds:function(){this._checkVisibilityChange();if(this._mBoundingInfoDirty){this._updateAABB()}return this._mAABB},hitTestPoint:function(a,c){var b=this.getBounds();return(a>b.x&&a<b.x+b.width&&c>b.y&&c<b.y+b.height)},markForRemoval:function(){this._mMarkedForRemoval=true;this.stage._trashObject(this)},markedForRemoval:function(){return this._mMarkedForRemoval},removeFromScene:function(){this.clearEventListeners();if(this.parent!==null){this.parent.removeChild(this)}},numChildren:function(a){return 0},bringForward:function(){if(this.parent!==null){var b=this.parent.getChildIndex(this);if(b<this.parent._mChildren.length-1){var a=this.parent._mChildren[b+1];this.parent._mChildren[b+1]=this;this.parent._mChildren[b]=a}}},bringToFront:function(){if(this.parent!==null){var a=this.parent.getChildIndex(this);this.parent._mChildren.splice(a,1);this.parent._mChildren.push(this)}},sendBackward:function(){if(this.parent!==null){var b=this.parent.getChildIndex(this);if(b>0){var a=this.parent._mChildren[b-1];this.parent._mChildren[b-1]=this;this.parent._mChildren[b]=a}}},sendToBack:function(){if(this.parent!==null){var a=this.parent.getChildIndex(this);this.parent._mChildren.splice(a,1);this.parent._mChildren.unshift(this)}},isMouseOver:function(){return this._mMouseOver},addEventListener:function(b,c){if(!this._mEventListeners[b]){this._mEventListeners[b]=[]}var a={id:TGE.DisplayObject._sNextEventListenerID++,listener:c};this._mEventListeners[b].push(a);if(b==="mousedown"||b==="mouseup"||b==="mousemove"||b==="mouseover"||b==="mouseout"){this.mouseEnabled=true}else{if(b==="update"){this._mRequiresUpdating=true}}return a.id},removeEventListener:function(c,d){if(this._mEventListeners[c]){var a=this._mEventListeners[c].length;for(var b=0;b<a;b++){if(this._mEventListeners[c][b].id===d||this._mEventListeners[c][b].listener===d){this._mEventListeners[c].splice(b,1);return}}TGE.log("***** ERROR: removeEventListener could not find listener specified for "+c+" event")}},removeEventListenersFor:function(a){if(this._mEventListeners[a]){this._mEventListeners[a]=[]}},clearEventListeners:function(){this._mEventListeners={}},dispatchEvent:function(a){if(typeof a.target==="undefined"){a.target=this}a.currentTarget=this;this.handleEvent(a)},handleEvent:function(c){if(this._mEventListeners[c.type]){c.currentTarget=this;var a=this._mEventListeners[c.type].length;for(var b=0;b<a;b++){if(this._mEventListeners[c.type]&&typeof this._mEventListeners[c.type][b]!=="undefined"){this._mEventListeners[c.type][b].listener.call(this,c)}}}},percentageOfWidth:function(a){return this.width*a},percentageOfHeight:function(a){return this.height*a},pixelsFromLeft:function(a){return a},pixelsFromRight:function(a){return this.width-a},pixelsFromTop:function(a){return a},pixelsFromBottom:function(a){return this.height-a},cullToViewport:function(d,b,a,c){if(this._mViewportCulling===null){this.addEventListener("camerachange",this._checkViewportCulling.bind(this))}this._mViewportCulling=[d,b,a,c]},useWorldPosition:function(a){if(a&&this._mWorldPositionListener===-1){this._mWorldPositionListener=this.addEventListener("camerachange",this._updateScreenPosition.bind(this))}else{if(!a&&this._mWorldPositionListener!==-1){this.removeEventListener("camerachange",this._mWorldPositionListener);this._mWorldPositionListener=-1}}},_updateScreenPosition:function(b){var a=(this.stage.width/2)+(this.worldX-b.cx);var c=(this.stage.height/2)-(this.worldY-b.cy);this.x=a;this.y=c},_checkViewportCulling:function(c){if(this._mViewportCulling===null){return}var b=this.getBounds();var a=false;if(this._mViewportCulling[0]&&b.y+b.height<0){a=true}if(this._mViewportCulling[1]&&b.x>this.stage.width){a=true}if(this._mViewportCulling[2]&&b.y>this.stage.height){a=true}if(this._mViewportCulling[3]&&b.x+b.width<0){a=true}if(a){this.markForRemoval()}},_draw:function(g){this._checkVisibilityChange();if(!this.visible){return}this._updateTransformations();if(this.stage!==null&&this.mouseEnabled){this.stage._mMouseTargets.push(this)}g.save();var e=this._mWorldTransform._internal;var f=this.stage===null?1:this.stage._mScale;var n=e[0]*f;var l=e[3]*f;var j=e[1]*f;var h=e[4]*f;var o=e[2]*f;var k=e[5]*f;if(this._mIgnoreProperties||this.rotation!==0){g.setTransform(n,l,j,h,o,k)}else{g.setTransform(n,l,j,h,o|0,k|0)}g.globalAlpha=this._mWorldAlpha;if(this.backgroundColor!==null){g.fillStyle=this.backgroundColor;g.fillRect(0,0,this.width,this.height)}this._drawClass(g);g.restore()},_drawClass:function(a){},_updateTransformations:function(){this._mWorldTransformDirty=false;var c=this.x!==this._mPreviousX||this.y!==this._mPreviousY||this.scaleX!==this._mPreviousScaleX||this.scaleY!==this._mPreviousScaleY||this.rotation!==this._mPreviousRotation||this._mVisibilityChanged;if(c&&!this._mIgnoreProperties){this._mVisibilityChanged=false;this._mPreviousX=this.x;this._mPreviousY=this.y;this._mPreviousScaleX=this.scaleX;this._mPreviousScaleY=this.scaleY;this._mPreviousRotation=this.rotation;this._mLocalTransformDirty=true}if(this.registrationX!==this._mPreviousRegistrationX||this.registrationY!==this._mPreviousRegistrationY||this.width!==this._mPreviousWidth||this.height!==this._mPreviousHeight){this._mPreviousRegistrationX=this.registrationX;this._mPreviousRegistrationY=this.registrationY;this._mPreviousWidth=this.width;this._mPreviousHeight=this.height;var b=-this.width*this.registrationX;var d=-this.height*this.registrationY;this._mRegistrationTransform.identity();this._mRegistrationTransform.translate(b,d)}if(this._mLocalTransformDirty){if(!this._mIgnoreProperties){this._mLocalTransform.identity();var a=this._mLocalTransform._internal;a[2]=this.x;a[5]=this.y;if(this.rotation!==0){this._mLocalTransform.rotate(this.rotation)}if(this.scaleX!==1||this.scaleY!==1){a[0]*=this.scaleX;a[1]*=this.scaleY;a[3]*=this.scaleX;a[4]*=this.scaleY}}this._mLocalTransformNoReg.copyFrom(this._mLocalTransform);this._mLocalTransform.concat(this._mRegistrationTransform)}if(this.parent!==null){if(this._mLocalTransformDirty||this.parent._mWorldTransformDirty){this._mWorldTransform.copyFrom(this.parent._mWorldTransformNoReg);this._mWorldTransform.concat(this._mLocalTransform);this._mWorldTransformNoReg.copyFrom(this.parent._mWorldTransformNoReg);this._mWorldTransformNoReg.concat(this._mLocalTransformNoReg);this._mWorldTransformDirty=true}}else{this._mWorldTransform.copyFrom(this._mLocalTransform);this._mWorldTransformDirty=this._mLocalTransformDirty}if(this._mWorldTransformDirty){this._setBoundingInfoDirty()}this._mWorldAlpha=this.parent!==null?this.parent._mWorldAlpha*this.alpha:this.alpha;this._mLocalTransformDirty=false},_updateAABB:function(){if(this._mWorldTransformDirty){this._updateTransformations()}this._mTopLeft.x=this._mBottomLeft.x=0;this._mBottomRight.x=this._mTopRight.x=this.width;this._mTopLeft.y=this._mTopRight.y=0;this._mBottomLeft.y=this._mBottomRight.y=this.height;if(this.rotation!==0||this._mIgnoreProperties){this._mWorldTransform.transformPoint(this._mTopLeft);this._mWorldTransform.transformPoint(this._mTopRight);this._mWorldTransform.transformPoint(this._mBottomLeft);this._mWorldTransform.transformPoint(this._mBottomRight);var a=Math.min(this._mTopLeft.x,this._mTopRight.x,this._mBottomLeft.x,this._mBottomRight.x);var c=Math.max(this._mTopLeft.x,this._mTopRight.x,this._mBottomLeft.x,this._mBottomRight.x);var d=Math.min(this._mTopLeft.y,this._mTopRight.y,this._mBottomLeft.y,this._mBottomRight.y);var b=Math.max(this._mTopLeft.y,this._mTopRight.y,this._mBottomLeft.y,this._mBottomRight.y)}else{this._mWorldTransform.transformPoint(this._mTopLeft);this._mWorldTransform.transformPoint(this._mBottomRight);var a=Math.min(this._mTopLeft.x,this._mBottomRight.x);var c=Math.max(this._mTopLeft.x,this._mBottomRight.x);var d=Math.min(this._mTopLeft.y,this._mBottomRight.y);var b=Math.max(this._mTopLeft.y,this._mBottomRight.y)}this._mAABB.x=a;this._mAABB.y=d;this._mAABB.width=c-a;this._mAABB.height=b-d;this._mBoundingInfoDirty=false},_setBoundingInfoDirty:function(){this._mBoundingInfoDirty=true;if(this.parent!==null){this.parent._setBoundingInfoDirty()}},_checkVisibilityChange:function(){if(this.visible!==this._mPreviousVisibility){this._mVisibilityChanged=true;this._mPreviousVisibility=this.visible;this._setBoundingInfoDirty()}},_setStage:function(a){this.stage=a}};TGE.DisplayObjectContainer=function(){TGE.DisplayObjectContainer.superclass.constructor.call(this);this._mChildren=[];return this};TGE.DisplayObjectContainer.prototype={addChild:function(a){if(a.parent!==null){a.parent.removeChild(a)}a.parent=this;this._mChildren.push(a);a._setStage(this.stage);return a},getChildAt:function(a){return this._mChildren[a]},getChildByName:function(c,b){b=typeof b==="undefined"?false:b;var a=this._mChildren.length;for(var d=0;d<a;d++){if(this._mChildren[d].instanceName===c){return this._mChildren[d]}if(b){var e=this._mChildren[d].getChildByName(c,true);if(e!==null){return e}}}return null},getChildIndex:function(c){var a=this._mChildren.length;for(var b=0;b<a;b++){if(this._mChildren[b]===c){return b}}return -1},removeChild:function(b){var a=this.getChildIndex(b);if(a!==-1){this._mChildren[a].parent=null;this._mChildren.splice(a,1)}return b},removeFromScene:function(){this.removeChildren();TGE.DisplayObjectContainer.superclass.removeFromScene.call(this)},removeChildren:function(){for(var a=this._mChildren.length-1;a>=0;a--){this._mChildren[a].removeFromScene()}this._mChildren=[]},clearChildren:function(){this.removeChildren()},numChildren:function(a){a=typeof a==="undefined"?false:a;var d=this._mChildren.length;if(a){var c=0;for(var b=0;b<d;b++){c+=1+this._mChildren[b].numChildren(true)}return c}return d},dispatchEvent:function(c){TGE.DisplayObjectContainer.superclass.dispatchEvent.call(this,c);var a=this._mChildren.length;for(var b=0;b<a;b++){if(this._mChildren[b]){this._mChildren[b].dispatchEvent(c)}}},_drawClass:function(b){TGE.DisplayObjectContainer.superclass._drawClass.call(this,b);var a=this._mChildren.length;for(var c=0;c<a;c++){var d=this._mChildren[c];d._checkVisibilityChange();if(d.visible){b.save();d._draw(b);b.restore()}}},_updateAABB:function(){TGE.DisplayObjectContainer.superclass._updateAABB.call(this);var a=this._mChildren.length;for(var b=0;b<a;b++){if(this._mChildren[b].visible){this._mAABB.union(this._mChildren[b].getBounds())}}},_setStage:function(a){TGE.DisplayObjectContainer.superclass._setStage.call(this,a);for(var b=this._mChildren.length-1;b>=0;b--){this._mChildren[b]._setStage(a)}}};extend(TGE.DisplayObjectContainer,TGE.DisplayObject);TGE.Stage=function(c,e,d){TGE.Stage.superclass.constructor.call(this);this._mCanvasContext=null;this._mMouseTargets=[];this._mObjectTrash=[];this._mMouseDown=false;this.stage=this;this.mouseEnabled=true;var a=false;if(c){if(c instanceof HTMLDivElement){a=false}else{if(c instanceof HTMLCanvasElement){a=true}else{c=document.body}}}var b;if(a){b=c}else{b=document.createElement("canvas");c.appendChild(b)}this.width=c.clientWidth;this.height=c.clientHeight;this.registrationX=0;this.registrationY=0;b.width=this.width;b.height=this.height;this.width=this._mOriginalWidth=typeof(e)!=="undefined"?e:c.clientWidth;this.height=this._mOriginalHeight=typeof(d)!=="undefined"?d:c.clientHeight;this._mScale=1;this._mCanvas=b;this._mCanvasContext=b.getContext("2d");return this};TGE.Stage.prototype={draw:function(){this._mMouseTargets=[];this._mCanvasContext.globalAlpha=1;this._mCanvasContext.globalCompositeOperation="source-over";this._draw(this._mCanvasContext)},setScale:function(a){this._mScale=a;this._mCanvas.width=this._mOriginalWidth*a;this._mCanvas.height=this._mOriginalHeight*a;this.width=this._mOriginalWidth;this.height=this._mOriginalHeight},isMouseDown:function(){return this._mMouseDown},_trashObject:function(a){this._mObjectTrash.push(a)},_emptyTrash:function(){len=this._mObjectTrash.length;for(i=0;i<len;i++){this._mObjectTrash[i].removeFromScene()}this._mObjectTrash=[]},_notifyObjectsOfMouseEvent:function(d,c,a){if(d==="down"){this._mMouseDown=true}else{if(d==="up"){this._mMouseDown=false}}var f={stageX:c,stageY:a};for(var b=this._mMouseTargets.length-1;b>=0;b--){var e=this._mMouseTargets[b];if(e.hitTestPoint(c,a)){if(true){switch(d){case"up":f.type="mouseup";e.handleEvent(f);if(!TGE.BrowserDetect.isMobileDevice){f.type="click";e.handleEvent(f)}break;case"down":f.type="mousedown";e.handleEvent(f);if(TGE.BrowserDetect.isMobileDevice){f.type="click";e.handleEvent(f)}break;case"move":f.type="mousemove";e.handleEvent(f);break}return}}}},_updateObjectMouseOverStates:function(c,a){for(var b=this._mMouseTargets.length-1;b>=0;b--){var e=this._mMouseTargets[b];var d=e.hitTestPoint(c,a);if(d){e._mMouseOver=true}else{if(e._mMouseOver){e._mMouseOver=false}}e.mouseX=c-e._mAABB.x;e.mouseY=a-e._mAABB.y}},_notifyObjectsOfKeyEvent:function(a,c){var b={type:a,keyCode:c};this.dispatchEvent(b)}};extend(TGE.Stage,TGE.DisplayObjectContainer);TGE.Sprite=function(){TGE.Sprite.superclass.constructor.call(this);this._mImage=null;this._mCellWidth=0;this._mCellHeight=0;this._mSpriteIndex=0;this._mCoordinateCache=null;return this};TGE.Sprite.prototype={setup:function(a){TGE.Sprite.superclass.setup.call(this,a);typeof(a.image)!=="undefined"?this.setImage(a.image):null;typeof(a.width)!=="undefined"?this.width=a.width:null;typeof(a.height)!=="undefined"?this.height=a.height:null;return this},setImage:function(f,e,d){e=typeof e==="undefined"?1:e;d=typeof d==="undefined"?1:d;this._mNumRows=e;this._mNumColumns=d;if(typeof f==="string"){f=TGE.AssetManager.GetImage(f)}if(f&&!(f instanceof Image)&&f.spriteSheet){this._mImage=f.spriteSheet;this._mNumRows=e;this._mNumColumns=d;this._mCellWidth=Math.floor(f.width/d);this._mCellHeight=Math.floor(f.height/e);this._mCoordinateCache=[];var b,a;for(var c=0;c<e*d;c++){b=f.x+((c%d)|0)*this._mCellWidth;a=f.y+((c/d)|0)*this._mCellHeight;this._mCoordinateCache.push([b,a])}this.width=this._mOriginalWidth=Math.floor(f.width/this._mNumColumns);this.height=this._mOriginalHeight=Math.floor(f.height/this._mNumRows)}else{if(f instanceof Image){this._mImage=f;this._mNumRows=e;this._mNumColumns=d;this._mOriginalWidth=Math.floor(f.width/this._mNumColumns);this._mOriginalHeight=Math.floor(f.height/this._mNumRows);this.width=this._mOriginalWidth;this.height=this._mOriginalHeight;this._resetCoordinateCache()}else{this._mImage=null}}this._mSpriteIndex=0},setSpriteIndex:function(a){if(this._mImage===null){TGE.log("***** ERROR: Attempt to call TGE.Sprite.setSpriteIndex on null image");return}this._mSpriteIndex=a;if(this._mSpriteIndex>=this._mCoordinateCache.length){TGE.log("***** ERROR: Attempt to call TGE.Sprite.setSpriteIndex with an out of range index ("+a.toString()+")");this._mSpriteIndex=0}},_drawClass:function(a){if(this._mImage!==null){a.drawImage(this._mImage,this._mCoordinateCache[this._mSpriteIndex][0]>>0,this._mCoordinateCache[this._mSpriteIndex][1]>>0,this._mOriginalWidth,this._mOriginalHeight,0,0,this.width,this.height)}TGE.Sprite.superclass._drawClass.call(this,a)},_resetCoordinateCache:function(){this._mCellWidth=Math.floor(this._mImage.width/this._mNumColumns);this._mCellHeight=Math.floor(this._mImage.height/this._mNumRows);this._mCoordinateCache=[];var b,a;for(var c=0;c<this._mNumRows*this._mNumColumns;c++){b=((c%this._mNumColumns)|0)*this._mCellWidth;a=((c/this._mNumColumns)|0)*this._mCellHeight;this._mCoordinateCache.push([b,a])}}};extend(TGE.Sprite,TGE.DisplayObjectContainer);TGE.SpriteSheetAnimation=function(){TGE.SpriteSheetAnimation.superclass.constructor.call(this);this.fps=24;this.totalFrames=1;this.looping=true;this._mAge=0;this._mPlaying=false;this._mCurrentFrame=-1;this.addEventListener("update",this._updateAnimation.bind(this));return this};TGE.SpriteSheetAnimation.prototype={setup:function(c){TGE.SpriteSheetAnimation.superclass.setup.call(this,c);var b=typeof(c.rows)==="number"?b=c.rows:1;var a=typeof(c.columns)==="number"?a=c.columns:1;if((b!==1||a!==1)&&typeof(c.image)!=="undefined"){this.setImage(c.image,b,a)}typeof(c.fps)==="number"?this.fps=c.fps:null;typeof(c.totalFrames)==="number"?this.totalFrames=c.totalFrames:null;typeof(c.looping)==="boolean"?this.looping=c.looping:true;typeof(c.width)!=="undefined"?this.width=c.width:null;typeof(c.height)!=="undefined"?this.height=c.height:null;return this},play:function(){this._mPlaying=true},stop:function(){this._mPlaying=false},gotoAndStop:function(a){this._jumpToFrame(a);this.stop()},gotoAndPlay:function(a){this._jumpToFrame(a);this.play()},currentFrame:function(){return this._mCurrentFrame},_jumpToFrame:function(a){this._setFrame(a);this._mAge=this._mCurrentFrame*(1/this.fps)},_setFrame:function(a){if(a===this._mCurrentFrame){return}this._mCurrentFrame=a;this.setSpriteIndex(a);this.handleEvent({type:"frame"+this._mCurrentFrame.toString(),frame:this._mCurrentFrame});if(!this.looping&&a===this.totalFrames-1){this.handleEvent({type:"finished",frame:this._mCurrentFrame})}},_updateAnimation:function(a){if(!this._mPlaying){return}this._mAge+=a.elapsedTime;var d=1/this.fps;var b=Math.floor(this._mAge/d);var c=this._mCurrentFrame;if(this.looping||b<this.totalFrames){c=b%this.totalFrames}else{c=this.totalFrames-1}this._setFrame(c)}};extend(TGE.SpriteSheetAnimation,TGE.Sprite);TGE.TFXAnimationSet=function(){TGE.TFXAnimationSet.superclass.constructor.call(this);this.imageSet=null;this.fps=24;this.looping=true;this._mAnimationsData=null;this._mInverseGlobalScale=1;this._mPartInstances=[];this._mCurrentAnimationID=null;this._mAge=0;this._mPlaying=false;this._mCurrentFrame=-1;this._mTotalFrames=1;this._mNextAnimation=null;this._mStopFrame=-1;this.addEventListener("update",this._updateAnimation.bind(this));return this};TGE.TFXAnimationSet.AddRequiredImagesToAssetList=function(e,f){var h=f.imageList;var a=f.location;var g=f.imageSet;var b=typeof(f.spriteSheet)==="string"?f.spriteSheet:null;g=(typeof g==="undefined")?null:g;if(h){if(typeof(a)==="undefined"){a=""}for(var c in e.parts){if(e.parts.hasOwnProperty(c)){var d=g===null?c:g+"_"+c;if(b!==null){h.push({id:d,url:(a+"/"+c+".png"),sheet:b})}else{h.push({id:d,url:(a+"/"+c+".png")})}}}}};TGE.TFXAnimationSet.ExpandData=function(a){if(typeof a!=="object"||!("f" in a)||a.f!=="cjson"){return a}return TGE.TFXAnimationSet._expand(a.t,a.v)};TGE.TFXAnimationSet.prototype={animationExists:function(a){return this._mAnimationsData!==null?this._mAnimationsData.animations[a]!==undefined:false},setCurrentAnimation:function(b,a){if(!this.animationExists(b)){TGE.log("***** ERROR: animation not found: '"+b+"'");return}this.looping=(typeof a==="undefined")?true:a;if(b!==this._mCurrentAnimationID){this._mCurrentAnimationID=b;this._mAge=0;this._mCurrentFrame=-1;this._mTotalFrames=this._mAnimationsData.animations[b].frames.length}this._mNextAnimation=null},setNextAnimation:function(b,a){this._mNextAnimation={anim:b,looping:a}},play:function(){this._mStopFrame=-1;this._mPlaying=true},playFromStart:function(){this.gotoAndPlay(0)},playUntilFrame:function(a){this.play();this._mStopFrame=a},stop:function(){this._mPlaying=false},gotoAndStop:function(a){this._mStopFrame=-1;this._jumpToFrame(a);this.stop()},gotoAndPlay:function(a){this._mStopFrame=-1;this._jumpToFrame(a);this.play()},currentFrame:function(){return this._mCurrentFrame},totalFrames:function(){return this._mTotalFrames},currentAnimation:function(){return this._mCurrentAnimationID},_setAnimationData:function(e){this._mAnimationsData=e;this.fps=e.framerate;this._mInverseGlobalScale=1/e.image_scale;if(this._mPartInstances.length>0){var b=this._mPartInstances.length;for(var d=0;d<b;d++){this._mPartInstances[d].markForRemoval()}}this._mPartInstances=[];var c=this._mAnimationsData.max_children;for(var d=0;d<c;d++){var a=this.addChild(new TGE.Sprite());a.visible=false;this._mPartInstances.push(a)}},_posePartInstances:function(h){if(this._mAnimationsData===null){return}var q=this._mAnimationsData.animations[this._mCurrentAnimationID];var g=q.frames[h];var o=this._mPartInstances.length;var m=g.instances.length;for(var l=0;l<o;l++){var j=this._mPartInstances[l];if(l>=m){j.visible=false}else{var r=g.instances[l];var e=this._mAnimationsData.part_instances[r.i];var n=this._mAnimationsData.parts[e];var k=this.imageSet===null?e:this.imageSet+"_"+e;j.setImage(k);j.registrationX=n.regx;j.registrationY=n.regy;var w=r.a===undefined?1:r.a;var u=r.b===undefined?0:r.b;var t=r.c===undefined?0:r.c;var s=r.d===undefined?1:r.d;var x=r.x===undefined?0:r.x;var v=r.y===undefined?0:r.y;var f=r.o===undefined?1:r.o;w*=this._mInverseGlobalScale;u*=this._mInverseGlobalScale;t*=this._mInverseGlobalScale;s*=this._mInverseGlobalScale;j.setLocalTransform(w,u,t,s,x,v);j.alpha=f;j.visible=true}}},_jumpToFrame:function(a){this._setFrame(a);this._mAge=this._mCurrentFrame*(1/this.fps)},_setFrame:function(a){if(a===this._mCurrentFrame){return}this._mCurrentFrame=a;if(this._mStopFrame>=0&&this._mCurrentFrame>=this._mStopFrame){this._mCurrentFrame=this._mStopFrame;this.stop()}this._posePartInstances(this._mCurrentFrame);this.handleEvent({type:"frame"+this._mCurrentFrame.toString(),frame:this._mCurrentFrame});if(!this.looping&&a===this._mTotalFrames-1){this.handleEvent({type:"finished",frame:this._mCurrentFrame});if(this._mNextAnimation!==null){this.setCurrentAnimation(this._mNextAnimation.anim,this._mNextAnimation.looping);this._mNextAnimation=null}}},_updateAnimation:function(a){if(!this._mPlaying){return}this._mAge+=a.elapsedTime;var d=1/this.fps;var b=Math.floor(this._mAge/d);var c=this._mCurrentFrame;if(this.looping||b<this._mTotalFrames){c=b%this._mTotalFrames}else{c=this._mTotalFrames-1}this._setFrame(c)}};extend(TGE.TFXAnimationSet,TGE.DisplayObjectContainer);TGE.TFXAnimationSet._getKeys=function(b,a){var c=[];while(a>0){c=b[a-1].slice(1).concat(c);a=b[a-1][0]}return c};TGE.TFXAnimationSet._expand=function(g,e){var n,c,j,l;if(typeof e==="object"){if(Object.prototype.toString.apply(e)==="[object Array]"){n=[];for(c=0;c<e.length;c++){n.push(TGE.TFXAnimationSet._expand(g,e[c]))}}else{n={};l=TGE.TFXAnimationSet._getKeys(g,e[""][0]);for(c=0;c<l.length;c++){n[l[c]]=TGE.TFXAnimationSet._expand(g,e[""][c+1])}}}else{n=e}if(n.version&&n.version===2){for(var j in n.animations){if(n.animations.hasOwnProperty(j)){var m={};var b=n.animations[j];for(var d=0;d<b.frames.length;d++){var a=b.frames[d];for(var c=0;c<a.instances.length;c++){var h=a.instances[c];var k=0.001;if(typeof(h.a)==="undefined"&&Math.abs(m[h.i].a-1)>k){h.a=m[h.i].a}if(typeof(h.b)==="undefined"&&Math.abs(m[h.i].b)>k){h.b=m[h.i].b}if(typeof(h.c)==="undefined"&&Math.abs(m[h.i].c)>k){h.c=m[h.i].c}if(typeof(h.d)==="undefined"&&Math.abs(m[h.i].d-1)>k){h.d=m[h.i].d}if(typeof(h.x)==="undefined"&&Math.abs(m[h.i].x)>k){h.x=m[h.i].x}if(typeof(h.y)==="undefined"&&Math.abs(m[h.i].y)>k){h.y=m[h.i].y}if(typeof(h.o)==="undefined"&&Math.abs(m[h.i].o-1)>k){h.o=m[h.i].o}m[h.i]=h}}}}}return n};TGE.Window=function(b,a){TGE.Window.superclass.constructor.call(this);this._mLayers={};this._mFadeDuration=0;this._mFadeColor=null;this._mFadePanel=null;this._mFadingOut=false;this._mCallback=null;this.registrationX=0;this.registrationY=0;this.width=b;this.height=a;this.mouseEnabled=true;this.alpha=0;this.addEventListener("update",this._updateTransitions.bind(this))};TGE.Window.prototype={transitionToWindow:function(b){var a=this._createNewWindow(b);a.show(this.stage,this.close.bind(this));return a},overlayWindow:function(b){var a=this._createNewWindow(b);a.show(this.stage);return a},resetToWindow:function(b){var a=this._createNewWindow(b);this.stage.removeChildren();a.show(this.stage);return a},createLayer:function(a){var b=new TGE.DisplayObjectContainer();this._mLayers[a]=b;b.registrationX=0;b.registrationY=0;b.width=this.width;b.height=this.height;b.instanceName=a;this.addChild(b)},getLayer:function(a){return(a in this._mLayers)?this._mLayers[a]:null},show:function(b,a){b.addChild(this);this._mCallback=(typeof a==="function")?a:null},close:function(a){this._mCallback=(typeof a==="function")?a:null;if(this._mFadeDuration>0){this._mFadingOut=true}else{this._forceClose()}},setupFade:function(b,a){this._mFadeColor=(typeof a!=="undefined")?a:null;this._mFadeDuration=b;if(this._mFadePanel!==null&&this._mFadeColor===null){this._destroyFadePanel()}if(this._mFadePanel!==null){this._mFadePanel.backgroundColor=this._mFadeColor}},_createNewWindow:function(b){var a=new b.windowClass(this.width,this.height);a.setup(b);if(typeof(b.fadeTime)==="number"){a.setupFade(b.fadeTime)}return a},_forceClose:function(){this.markForRemoval();if(this._mCallback!==null){this._mCallback.call();this._mCallback=null}},_updateTransitions:function(b){var a=b.elapsedTime;if(this._mFadeColor!==null&&this._mFadePanel===null){this._setupFadePanel()}var c=this._mFadePanel===null?this.alpha:1-this._mFadePanel.alpha;if(this._mFadeDuration>0){if(this._mFadingOut){c-=(a*(1/this._mFadeDuration));if(c<0){c=0;this._forceClose()}}else{if(c<1){c+=(a*(1/this._mFadeDuration));if(c>1){c=1;if(this._mCallback!==null){this._mCallback.call();this._mCallback=null}}}}}else{c=1}if(this._mFadePanel===null){this.alpha=c}else{this._mFadePanel.visible=true;this._mFadePanel.alpha=1-c;this.alpha=1}},_setupFadePanel:function(){this._mFadePanel=new TGE.DisplayObjectContainer().setup({width:this.width,height:this.height,backgroundColor:this._mFadeColor});this._mFadePanel.registrationX=this._mFadePanel.registrationY=0;this.addChild(this._mFadePanel)},_destroyFadePanel:function(){if(this._mFadePanel!==null){this._mFadePanel.markForRemoval();this._mFadePanel=null}}};extend(TGE.Window,TGE.Sprite);TGE.AudioLoader=function(c,b,e,j,f){var h=this;this.id=c;this.loader=null;this.forceHandler=null;this.audio=document.createElement("audio");this.audio.setAttribute("preload","auto");document.body.appendChild(this.audio);if(TGE.BrowserDetect.browser==="Safari"||TGE.BrowserDetect.onWindowsMobile){if(typeof b!=="undefined"){if(e.lastIndexOf("mp3")==e.length-"mp3".length){var d=b;b=e;e=d}}}var a=document.createElement("source");a.setAttribute("src",b);this.audio.appendChild(a);var g=document.createElement("source");g.setAttribute("src",e);this.audio.appendChild(g);this.url=b;this.tags=j;this.priority=f;this.complete=false;this.pollCount=0;this.start=function(m){this.loader=m;if(this.isLimited()){var l=function(){this.audio.pause();this.audio.removeEventListener("play",this.forceHandler,false);this.complete=true;this.loader.onLoad(h);this.audio.play()};this.forceHandler=l.bind(this);this.audio.addEventListener("play",this.forceHandler,false);this.audio.play()}else{var k=function(){this.audio.removeEventListener("loadedmetadata",this.forceHandler,false);this.complete=true;this.loader.onLoad(h)};this.forceHandler=k.bind(this);this.audio.addEventListener("loadedmetadata",this.forceHandler,false);this.audio.load()}};this.checkStatus=function(){if(this.audio.networkState===HTMLMediaElement.NETWORK_NO_SOURCE){this.loader.onError(h);return}if(this.pollCount>=3){this.loader.onTimeout(h);return}if(this.complete===true||TGE.BrowserDetect.onWindowsMobile){this.loader.onLoad(h)}if(this.isLimited()){this.loader.onTimeout(h);return}this.pollCount++};this.onTimeout=function(){this.loader.onTimeout(h)};this.getName=function(){return b}};TGE.AudioLoader.prototype.isLimited=function(){return(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad")};if(typeof(PxLoader)==="function"){PxLoader.prototype.addAudio=function(f,e,d,a,b){var c=new TGE.AudioLoader(f,e,d,a,b);this.add(c);return c.audio}}TGE.AudioManager=function(a){this.mAssetManager=a;this.mVolume=1;this.mMuted=false;this.mplayerManagerList={}};TGE.AudioManager.prototype={Play:function(b){if(getDistributionPartner()==="A0011"){return}var a=null;if(b.id in this.mplayerManagerList){a=this.mplayerManagerList[b.id]}else{a=new TGE.PlayerManager(this);if(a.init(b)===false){return}this.mplayerManagerList[b.id]=a}if(this.isMobile()==true&&this.mMuted===true){return}if(this.isMobile()==true&&a.isPlaying()===true){return}a.playAudio(b)},Pause:function(b){if(b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.pauseAudio()}},Mute:function(){if(this.mMuted===true){return}this.mMuted=true;for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];if(this.isMobile()===true){if(a.nLoop==0){a.stopAudio()}else{a.pauseAudio()}}else{a.muteAudio()}}},Unmute:function(){if(this.mMuted===false){return}this.mMuted=false;for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];if(this.isMobile()===true){if(a.nLoop!=0){if(a.mState===a.STATE.Stopped){a.playAudio({})}else{a.resumeAudio()}}}else{a.unmuteAudio()}}},ToggleMute:function(){if(this.mMuted===true){this.Unmute()}else{this.Mute()}},StopAll:function(){if(this.isMobile()==true&&this.mMuted===true){return}for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.stopAudio()}},PauseAll:function(){for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];a.pauseAudio()}},ResumeAll:function(){for(var b in this.mplayerManagerList){var a=this.mplayerManagerList[b];if(this.isMobile()==true&&this.mMuted===true){continue}a.resumeAudio()}},isLoadAudio:function(){return this.mAssetManager.loadAudio},isMobile:function(){return(TGE.BrowserDetect.platform!=="Windows"&&TGE.BrowserDetect.platform!=="Mac")}};TGE.PlayerManager=function(a){this.mAudioManager=a;this.nStartTime=0;this.nEndTime=-1;this.nLoop=0;this.callback=null;this.audioElement=null;this.bPlaySegment=false;this.STATE={NotLoaded:0,Playing:1,Stopped:2,Paused:3,AutoPaused:4};this.mState=this.STATE.NotLoaded;this.audioId=null;this.audioPlaybackInProgressHandler=null;this.audioPlaybackCompleteHandler=null};TGE.PlayerManager.prototype={init:function(b){this.mState=this.STATE.NotLoaded;this.audioId=b.id;var d=this;this.callback=(b.callBackFunction!==undefined?b.callBackFunction:null);this.audioElement=this.mAudioManager.mAssetManager.getImage(b.id);if(undefined===this.audioElement){TGE.log("Unknown audio id: "+b.id);return false}this.nStartTime=0;this.nEndTime=-1;if("audio_sprite"===this.audioElement.assetType){this.bPlaySegment=true;this.nStartTime=this.audioElement.startTime;this.nEndTime=this.audioElement.endTime;this.audioElement=this.mAudioManager.mAssetManager.getImage(this.audioElement.id)}if(TGE.BrowserDetect.platform==="Android"||TGE.BrowserDetect.platform==="Kindle Fire"){this.bPlaySegment=true;this.nStartTime=0;this.nEndTime=this.audioElement.duration}if(this.audioElement.canPlayType){}else{TGE.log("No canPlayType attribute found in audio tag: "+b.id);return false}this.nLoop=0;if(b.loop!==undefined){this.nLoop=Number(b.loop)}if(this.nLoop===undefined){this.nLoop=0}var c=function(){if(this.bPlaySegment){if(this.audioElement.currentTime<this.nStartTime){this.audioElement.currentTime=this.nStartTime}if(this.audioElement.currentTime>=this.nEndTime){if(this.nLoop===0){this.stopAudio()}else{this.restartAudio()}}}};var a=function(){if(this.nLoop===0){this.stopAudio()}else{this.restartAudio()}};this.audioElement.addEventListener("timeupdate",c.bind(this),false);this.audioElement.addEventListener("ended",a.bind(this),false);window.addEventListener("pagehide",function(){if(d.mState===d.STATE.Playing){d.pauseAudio();d.mState=d.STATE.AutoPaused}});window.addEventListener("pageshow",function(){if(d.mState===d.STATE.AutoPaused){d.resumeAudio()}});this.mState=this.STATE.Stopped;return true},playAudio:function(a){if(this.mAudioManager.isLoadAudio()===false){return}if(this.mAudioManager.mMuted===true){this.audioElement.volume=0}else{this.audioElement.volume=this.mAudioManager.mVolume}try{this.audioElement.currentTime=this.nStartTime}catch(b){TGE.log("Error setting start time, continuing: "+b)}if(this.bPlaySegment===false){this.nEndTime=this.audioElement.duration}this.mState=this.STATE.Playing;this.audioElement.play()},stopAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.mState=this.STATE.Stopped;this.audioElement.pause();this.audioElement.currentTime=0;if(this.callback!==null){this.callback()}},restartAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.mState=this.STATE.Playing;this.audioElement.currentTime=this.nStartTime;this.audioElement.play()},pauseAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}if(this.mState!==this.STATE.Playing){return}this.mState=this.STATE.Paused;this.audioElement.pause()},resumeAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}if(this.mState!==this.STATE.Paused){return}this.mState=this.STATE.Playing;this.audioElement.play()},muteAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.audioElement.volume=0},unmuteAudio:function(){if(this.mAudioManager.isLoadAudio()===false){return}if(undefined===this.audioElement){return}this.audioElement.volume=this.mAudioManager.mVolume},isPlaying:function(){if(this.mState===this.STATE.Playing){return true}return false}};TGE.Game=function(){if(TGE.Game._sInstance!==null){TGE.log("***** ERROR: you can only create one instance of a TGE.Game object");return this}TGE.Game._sInstance=this;this.analytics=null;this.mCanvasDiv=null;this.mReorientationDiv=null;this.mCanvasPosition=null;this.mLayers={};this.mCameraLocation=null;this.mLoadingStartTime=new Date().getTime();this.mLoadingScreen=null;this.stage=null;this.assetManager=new TGE.AssetManager();this.audioManager=new TGE.AudioManager(this.assetManager);this.onLoad=null;this.mPlaying=false;this.mPaused=false;this.mCurrentLevel=null;this.pauseButton=null;this._mUserPauseEnabled=false;this.mGameTime=0;this._mFilterStrength=10;this._mFrameTime=0;this._mLastLoop=new Date;this._mLastDisplay=new Date;this._mThisLoop;this._mFPSText=null;this.mMaxTickTime=0.1;this.mMinTickTime=Number.MIN_VALUE;this.mScreenManager=null;this._mRegisteredScreens=[];this._mDeprecatedScreens=[];this._mPauseScreen=null;this.mMouseX=0;this.mMouseY=0;this.mMouseDown=false;this.mKeysDown={};this.mDefaultLinkTarget="_blank";this._mUpdateRoot=null;this.canvasWidth=0;this.canvasHeight=0;this.scaleToFitOnDesktop=false;this.centerHorizontallyOnDesktop=true;this.centerVerticallyOnDesktop=false;this._mNativeScaling=null;this._mViewportScale=1;this._mDivResized=false;this._miOS5Scale=-1;this._mRAFID=null;var a=(navigator.userAgent.toString().toLowerCase()).indexOf("samsung")!==-1;this._mUseRAFHack=TGE.BrowserDetect.onAndroid&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))>=4&&a;this._oniOS=(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad");this._onAndroid=(TGE.BrowserDetect.platform==="Android")};TGE.LoadingWindow=TGE.DefaultLoadingWindow;TGE.FirstGameWindow=null;TGE.DisableViewportResizing=false;TGE.DisableLostFocusPause=false;TGE.Game._sInstance=null;TGE.Game.GetInstance=function(){return TGE.Game._sInstance};TGE.Game.OpenURL=function(a){window.open(a,"_blank")};TGE.Game.GameDiv=function(){return TGE.Game.GetInstance().mCanvasDiv};TGE.Game.SetUpdateRoot=function(a){TGE.Game.GetInstance()._mUpdateRoot=a};TGE.Game.prototype={_mViewportScale:0,_mResizeTimeout:null,_oniOS:false,_onAndroid:false,onMobile:function(){return TGE.BrowserDetect.isMobileDevice},oniOS:function(){return this._oniOS},onAndroid:function(){return this._onAndroid},onPhoneGap:function(){return TGE.BrowserDetect.usingPhoneGap},registerScreen:function(b,a){this._mRegisteredScreens[b]=a},registerDeprecatedScreen:function(b,a){this._mDeprecatedScreens[b]=a},showManagedScreen:function(a){if(this._mRegisteredScreens[a]){return this.stage.addChild(this._mRegisteredScreens[a].call(this))}else{if(this._mDeprecatedScreens[a]){return this.ShowScreen(this._mDeprecatedScreens[a])}}return null},IsPlatformAcceptable:function(){var b=!!window.CanvasRenderingContext2D;if(!b){this.AnalyticErrorEvent("no canvas");return false}var e=false;if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var a=TGE.BrowserDetect.OSversion.charCodeAt(0)-48;return a>=5}if(TGE.BrowserDetect.Platform==="Android"){return true}if(TGE.BrowserDetect.platform==="Windows"||TGE.BrowserDetect.platform==="Mac"){var d=TGE.BrowserDetect.browser.toLowerCase();var c=parseFloat(TGE.BrowserDetect.version);if(d=="firefox"){return c>=8}else{if(d=="explorer"){return c>=9}else{if(d=="chrome"){return c>=14}else{if(d=="safari"){return c>=5.1}else{}}}}}return true},launch:function(k){var j=typeof k.gameDiv==="string"?k.gameDiv:null;var d=typeof k.reorientDiv==="string"?k.reorientDiv:null;var b=typeof k.width==="number"?k.width:-1;var l=typeof k.height==="number"?k.height:-1;var c=typeof k.initialWidth==="number"?parseInt(k.initialWidth):-1;var e=typeof k.initialHeight==="number"?parseInt(k.initialHeight):-1;var h=typeof k.resizeForNative==="undefined"?false:k.resizeForNative;this.onLoad=typeof k.onLoad==="function"?k.onLoad:null;this.mCanvasDiv=document.getElementById(j);if(this.mCanvasDiv==null){TGE.log("***** ERROR: Could not find canvas div '"+j+"'");return false}var a=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",a+" z-index: 1; overflow: hidden; -webkit-user-select: none; -ms-touch-action:none; -webkit-tap-highlight-color: transparent; -moz-tap-highlight-color: transparent; -webkit-transform: translateZ(0);");if(h){var g=document.getElementById("viewporter");if(g!==null){g.align="left"}var f=1;if(TGE.BrowserDetect.platform==="iPad"){f=768/1024;b=this.mCanvasDiv.clientWidth;l=Math.round(f*b)}else{if(TGE.BrowserDetect.platform==="iPhone"){f=320/480;b=this.mCanvasDiv.clientWidth;l=Math.round(f*b);if(g!==null&&(window.innerWidth>480||window.innerHeight>480)){g.align="center"}}}if(f!==1){this._mNativeScaling={x:(b/this.mCanvasDiv.clientWidth),y:(l/this.mCanvasDiv.clientHeight)}}}if(b>0&&l>0){this.mCanvasDiv.style.width=b+"px";this.mCanvasDiv.style.height=l+"px"}this.canvasWidth=this.mCanvasDiv.clientWidth;this.canvasHeight=this.mCanvasDiv.clientHeight;TGE.debugLog("game launch calling _resizeViewport");this._resizeViewport();this.mReorientationDiv=document.getElementById(d);this._determineCanvasPosition();window.addEventListener("resize",this._onResize.bind(this),false);if(this.onMobile()&&!TGE.DisableLostFocusPause){window.addEventListener("blur",this._onDeactivate.bind(this),false);window.addEventListener("pagehide",this._onDeactivate.bind(this),false);if(this.onPhoneGap()){document.addEventListener("pause",this._onDeactivate.bind(this),false)}}if("ontouchstart" in document.documentElement&&TGE.BrowserDetect.isMobileDevice){this.mCanvasDiv.addEventListener("touchstart",this._mouseDown.bind(this),false);this.mCanvasDiv.addEventListener("touchmove",this._mouseMove.bind(this),false);this.mCanvasDiv.addEventListener("touchend",this._mouseUp.bind(this),false)}else{this.mCanvasDiv.addEventListener("click",this._preventBehavior.bind(this),false);this.mCanvasDiv.addEventListener("mousedown",this._mouseDown.bind(this),false);this.mCanvasDiv.addEventListener("mouseup",this._mouseUp.bind(this),false);this.mCanvasDiv.addEventListener("mousemove",this._mouseMove.bind(this),false)}document.addEventListener("keydown",this._keyDown.bind(this),false);document.addEventListener("keyup",this._keyUp.bind(this),false);if(c>0&&e>0){this._initializeRenderer(c,e)}else{this._initializeRenderer()}window.addEventListener("orientationchange",this._onOrientationChanged);if((typeof viewporter!=="undefined")&&(typeof viewporter.preventPageScroll==="function")){viewporter.preventPageScroll=true}if(typeof(window.TGS)!=="undefined"){TGS.DataStore.onDataChanged=this._onTGSDatastoreUpdated.bind(this);TGS.onUserChanged=this._onTGSUserChanged.bind(this);TGS.onReady=this._onTGSReady.bind(this);if(TGS.IsReady()){this._onTGSReady()}}this._beginLoad();return true},_determineCanvasPosition:function(){TGE.debugLog("_determineCanvasPosition");this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},_onOrientationChanged:function(){TGE.debugLog("_onOrientationChanged called");if((typeof viewporter!=="undefined")&&(typeof viewporter.refresh==="function")){viewporter.refresh()}},_onResize:function(){TGE.debugLog("_onResize::_mResizeTimeout: "+this._mResizeTimeout);if(this._mResizeTimeout!==null){clearTimeout(this._mResizeTimeout);this._mResizeTimeout=null}if(this.onAndroid()){this._mResizeTimeout=setTimeout(this._resizeViewport.bind(this),500)}else{this._resizeViewport()}},_scaleByResizing:function(c){if(this.stage===null){return}TGE.debugLog("resizing game by resizing game div");var b=Math.round(this.stage.width*c*1000)/1000;var a=Math.round(this.stage.height*c*1000)/1000;this.mCanvasDiv.style.width=b+"px";this.mCanvasDiv.style.height=a+"px";this._scaleStage(c)},_scaleByCSS2D:function(b){TGE.debugLog("resizing game using a 2D CSS transform");this._mViewportScale=b;var a=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",a+" -ms-transform-origin: 0% 0%; -webkit-transform-origin: 0% 0%; -moz-transform-origin: 0% 0%; -o-transform-origin: 0% 0%; transform-origin: 0% 0%; -ms-transform: scale("+b+"); -webkit-transform: scale("+b+"); -moz-transform: scale("+b+"); -o-transform: scale("+b+"); transform: scale("+b+");");this._mDivResized=false},_scaleByCSS3D:function(c){TGE.debugLog("resizing game using a 3D CSS transform");var b=c+","+c;this._mViewportScale=c;var a=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",a+" -webkit-transform: rotateZ(360deg); -ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale("+b+"); -webkit-transform: scale3d("+b+", 1); -moz-transform: scale("+b+"); -o-transform: scale("+b+"); transform: scale("+b+");");this._mDivResized=false},_scaleByViewportTag:function(b){TGE.debugLog("resizing game by scaling the viewport meta-tag");var a=document.querySelector("meta[name=viewport]");if(a){a.setAttribute("content","maximum-scale="+b+", minimum-scale="+b+", initial-scale="+b+", user-scalable=no")}this._mDivResized=false},_getBrowserWidth:function(){if(window.innerWidth){return window.innerWidth}if(document.documentElement&&document.documentElement.clientWidth!=0){return document.documentElement.clientWidth}if(document.body){return document.body.clientWidth}return 0},_getBrowserHeight:function(){if(window.innerHeight){return window.innerHeight}if(document.documentElement&&document.documentElement.clientHeight!=0){return document.documentElement.clientHeight}if(document.body){return document.body.clientHeight}return 0},_scaleStage:function(a){this._mViewportScale=a;this._mDivResized=true;if(this.stage!==null){this.stage.setScale(this._mViewportScale)}this._determineCanvasPosition()},_centerCanvasDiv:function(b,c,e,a){if(!b&&!c){return}this.mCanvasDiv.style.position="absolute";if(b){this.mCanvasDiv.style.align="left";this.mCanvasDiv.style.left=Math.floor((this._getBrowserWidth()/2)-(e/2))+"px";var d=document.getElementById("viewporter");if(d){d.style.align="left"}}if(c){this.mCanvasDiv.style.top=Math.floor((this._getBrowserHeight()/2)-(a/2))+"px"}},_resizeToFit:function(c,m){var e=this.canvasWidth;var j=this.canvasHeight;var a=c;var b=m;var h=e<=j;var k=a<=b;var l=k===h;var g=this._determineViewportScale(e,j,a,b);this._scaleByResizing(g);var f=e*g;var d=j*g;this._centerCanvasDiv(true,false,f,d);this._handleOrientation(l);this._determineCanvasPosition()},_resizeViewport:function(){TGE.debugLog("_resizeViewport");if(TGE.DisableViewportResizing){return}if(typeof window.canvasScale!=="undefined"){TGE.debugLog("_resizeViewport for JSEmbed using stage scaling");this._scaleStage(window.canvasScale);return}var e=this.mCanvasDiv;var b=e.getAttribute("style")||"";var f=this.canvasWidth;var k=this.canvasHeight;var a=window.innerWidth;var c=window.innerHeight;var j=f<=k;var l=a<=c;var m=l===j;var h=this._determineViewportScale(f,k,a,c);var g=f*h;var d=k*h;if(TGE.BrowserDetect.isMobileDevice){if(TGE.BrowserDetect.platform==="Kindle Fire"&&(TGE.BrowserDetect.browser==="Silk"&&TGE.BrowserDetect.version<=1)||(TGE.BrowserDetect.browser==="Amazon Web App"&&Math.floor(TGE.BrowserDetect.version)<=533)){this._scaleByResizing(h);this._centerCanvasDiv(true,true,g,d)}else{if((TGE.BrowserDetect.platform==="iPhone"&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<6)){if(m){if(this._miOS5Scale===-1){this._miOS5Scale=h}this._scaleByViewportTag(this._miOS5Scale)}else{this._scaleByViewportTag(1)}this._centerCanvasDiv(true,true,g,d)}else{if((TGE.BrowserDetect.onAndroid&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<4)){this._scaleByCSS2D(h);this._centerCanvasDiv(true,true,g,d)}else{this._scaleByCSS3D(h);this._centerCanvasDiv(true,true,g,d)}}}}else{if(false){this._scaleByResizing(h);this._centerCanvasDiv(true,true,g,d)}else{if(this.scaleToFitOnDesktop){this._scaleByCSS2D(h);this._centerCanvasDiv(true,true,g,d)}else{this._centerCanvasDiv(this.centerHorizontallyOnDesktop,this.centerVerticallyOnDesktop,f,k)}}}this._handleOrientation(m);this._determineCanvasPosition();if((typeof viewporter!=="undefined")&&(typeof viewporter.refresh==="function")){viewporter.refresh()}},_determineViewportScale:function(b,d,c,f){var e={x:1,y:1};e.x=c/b;e.y=f/d;e.x=Math.ceil(e.x*1000)/1000;e.y=Math.ceil(e.y*1000)/1000;var a=1;if(e.x<e.y){a=e.x}else{a=e.y}if(Math.abs(1-a)<=0.01){a=1}return a},_handleOrientation:function(a){if(this.mReorientationDiv!==null&&TGE.BrowserDetect.isMobileDevice){if(!a){this.mCanvasDiv.style.display="none";this.mReorientationDiv.style.display="block";this.PauseGame(true)}else{this.mReorientationDiv.style.display="none";this.mCanvasDiv.style.display="block"}}},_onDeactivate:function(){if(this.mPlaying){this.PauseGame(true);this.audioManager.Mute()}if(this._mUseRAFHack&&this._mRAFID){cancelAnimationFrame(this._mRAFID);this._mRAFID=null}},_initializeRenderer:function(b,a){this.stage=new TGE.Stage(this.mCanvasDiv,b,a)},_beginLoad:function(){this.assetManager.loadAssetList("loading",null,this._loadRequiredAssets.bind(this))},_loadRequiredAssets:function(){if(this.mScreenManager!==null){this.mScreenManager.Initialize(this)}this._resizeViewport();var a=null;this.mLoadingScreen=this.showManagedScreen("loading");if(this.mLoadingScreen!==null){a=this._loadRequiredAssetsCallback.bind(this)}this._update();this.assetManager.loadAssetList("required",a,this._finishedLoadingRequiredAssets.bind(this))},_loadRequiredAssetsCallback:function(a){if(this.mLoadingScreen!==null){this.mLoadingScreen.handleEvent({type:"progress",percentComplete:a});if(typeof(this.mLoadingScreen.UpdateProgress)=="function"){this.mLoadingScreen.UpdateProgress(a)}}},_finishedLoadingRequiredAssets:function(){var a=Math.round((new Date().getTime()-this.mLoadingStartTime)/1000);this.AnalyticGameEvent("load",a);TGE.debugLog("_finishedLoadingRequiredAssets calling _resizeViewport");this._resizeViewport();this.launchGame()},_update:function(){var b=(this._mThisLoop=new Date)-this._mLastLoop;this._mFrameTime+=(b-this._mFrameTime)/this._mFilterStrength;this._mLastLoop=this._mThisLoop;this.updateFPSDisplay();b=b/1000;b=Math.max(this.mMinTickTime,b);b=Math.min(this.mMaxTickTime,b);if(!this.mPaused){this.mGameTime+=b}if(this.mScreenManager!==null){this.mScreenManager.Update(b)}this.stage._updateObjectMouseOverStates(this.mMouseX,this.mMouseY);var a={type:"update",elapsedTime:b};if(!this.mPaused){if(!this._mUpdateRoot||this._mUpdateRoot.markedForRemoval()||this._mUpdateRoot.parent===null){this._mUpdateRoot=this.stage}this._mUpdateRoot.dispatchEvent(a)}else{if(this._mPauseScreen!==null){this._mPauseScreen.dispatchEvent(a)}}this.stage._emptyTrash();if(this.mPlaying&&!this.mPaused){this.subclassUpdateGame(b)}if(this.mCameraLocation!==null){var c={type:"camerachange",cx:this.mCameraLocation.x,cy:this.mCameraLocation.y};this.stage.dispatchEvent(c)}if(this._mUseRAFHack&&this._mRAFID){cancelAnimationFrame(this._mRAFID);this._mRAFID=null}this._mRAFID=requestAnimationFrame(this._update.bind(this));this.stage.draw()},launchGame:function(){this.stage.removeChildren();if(TGE.FirstGameWindow){this.stage.addChild(new TGE.FirstGameWindow(this.stage.width,this.stage.height).setup({}))}else{if(typeof(this.GotoMainMenu)==="function"){this.GotoMainMenu()}}if(this.onLoad!==null){this.onLoad.call(this)}},_onTGSDatastoreUpdated:function(){this.onTGSDatastoreUpdated();this.stage.dispatchEvent({type:"tgs_data_updated"})},_onTGSUserChanged:function(){this.onTGSUserChanged();this.stage.dispatchEvent({type:"tgs_user_changed"})},_onTGSReady:function(){this.onTGSReady();this._onTGSDatastoreUpdated()},onTGSReady:function(){},onTGSDatastoreUpdated:function(){},onTGSUserChanged:function(){},Launch:function(b,a){if(this.analytics===null&&this.mAnalytics!=null){this.analytics=this.mAnalytics}if(typeof b==="string"){this.launch({gameDiv:b,reorientDiv:a})}else{this.launch(b)}},LoadLevelAssets:function(c,b,a){this.assetManager.loadAssetList("level_"+c.toString(),b,a)},StartLevel:function(a){var b=a==this.mCurrentLevel;this.mCurrentLevel=a;this.subclassSetupLevel(this.mCurrentLevel);this.AnalyticLevelEvent(b?"replay":"start");if(!this.mPlaying||this.mPaused){this.StartPlaying()}},FinishLevel:function(){this.AnalyticLevelEvent("complete");this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0;this.mPaused=false;this.mPlaying=true;if(typeof(window.TGS)!=="undefined"){TGS.EnablePartnerUI(false)}this.subclassStartPlaying()},clearScene:function(){this.mCameraLocation=new TGE.Point();this.stage.removeChildren();this._mFPSText=null;this.SetupLayers();if(this.mScreenManager!==null){this.mScreenManager.Initialize(this)}this.CreateLayer("FPS");var b=this.assetManager.getImage("pause_button",false);if(b!=null&&b.width>0){var a=Math.max(b.width,b.height);this.pauseButton=new TGE.Button().setup({x:this.Width()-a/2,y:a/2,image:"pause_button"});this.getLayer("ScreenManager").addChild(this.pauseButton);this.EnableUserPause()}},SetupLayers:function(){this.mLayers={};this.CreateLayer("TGE_default");this.subclassSetupLayers()},ShowScreen:function(a){if(this.mScreenManager!==null){return this.mScreenManager.ShowScreen(a)}return null},GotoMainMenu:function(){this.mPaused=false;this.mPlaying=false;this.clearScene();if(this.showManagedScreen("mainmenu")===null){this.StartPlaying()}if(typeof(window.TGS)!=="undefined"){if(TGS.IsOn()&&!TGS.IsReady()){this.showManagedScreen("tgsconnect")}}},PauseGame:function(b){var a=this._mDeprecatedScreens.pause!=null||this._mRegisteredScreens.pause!=null;if(!this.mPlaying||b===this.mPaused||!a){return}this.mPaused=b;this.AnalyticGameEvent(this.mPaused?"pause":"resume",this.mCurrentLevel);this._determineCanvasPosition();if(this.mPaused){if(this._mDeprecatedScreens.pause&&this.mScreenManager!==null){this.ShowScreen(this._mDeprecatedScreens.pause,false)}else{this._mPauseScreen=this.showManagedScreen("pause")}this.DisableUserPause()}else{if(this._mDeprecatedScreens.pause&&this.mScreenManager!==null){this.mScreenManager.CloseScreen(this._mDeprecatedScreens.pause)}else{if(this._mPauseScreen!==null){this._mPauseScreen.close()}}this.EnableUserPause()}if(typeof(window.TGS)!=="undefined"){TGS.EnablePartnerUI(this.mPaused)}},DisableUserPause:function(){this._mUserPauseEnabled=false;if(this.pauseButton!==null){this.pauseButton.visible=false}},EnableUserPause:function(){this._mUserPauseEnabled=true;if(this.pauseButton!==null){this.pauseButton.visible=true}},SetConstantTickTime:function(a){this.mMinTickTime=this.mMaxTickTime=a},setBackgroundColor:function(a){this.stage.backgroundColor=a},CreateLayer:function(a){var b=new TGE.DisplayObjectContainer();this.mLayers[a]=b;b.registrationX=0;b.registrationY=0;b.width=this.stage.width;b.height=this.stage.height;b.instanceName=a;this.stage.addChild(b)},getLayer:function(a){var b="TGE_default" in this.mLayers?this.mLayers.TGE_default:this.stage;if(a!=null&&a in this.mLayers){b=this.mLayers[a]}return b},ShowFramerateDisplay:function(a,d,c,b){if(this._mFPSText!==null){this._mFPSText.markForRemoval()}this._mFPSText=new TGE.Text().setup({x:a,y:d,font:c.toString()+"px Arial",color:b});this.getLayer("FPS").addChild(this._mFPSText)},updateFPSDisplay:function(){var a=this._mThisLoop-this._mLastDisplay;if(a<1000){return}this._mLastDisplay=this._mThisLoop;if(this._mFrameTime>0&&this._mFPSText!==null){this._mFPSText.visible=true;this._mFPSText.text=(Math.round(1000/this._mFrameTime).toFixed(0)+"fps")}},EndGame:function(){if(!this.mPlaying){return}this.mPlaying=false;if(typeof(window.TGS)!=="undefined"){TGS.EnablePartnerUI(true)}var a=Math.round(this.mGameTime);this.AnalyticGameEvent("end",a);this.DisableUserPause();this.subclassEndGame();this.showManagedScreen("gameover")},CurrentLevel:function(){return this.mCurrentLevel},_processMousePosition:function(a){if(this.mCanvasPosition===null){this._determineCanvasPosition()}this.mMouseX=a.pageX;this.mMouseY=a.pageY;if(a.touches){this.mMouseX=a.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft;this.mMouseY=a.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop}this.mMouseX-=this.mCanvasPosition.x;this.mMouseY-=this.mCanvasPosition.y;this.mMouseX/=this._mViewportScale;this.mMouseY/=this._mViewportScale},_preventBehavior:function(a){a.stopPropagation();a.preventDefault()},_mouseDown:function(a){window.focus();if(this._mUseRAFHack&&this._mRAFID===null){this._mRAFID=requestAnimationFrame(this._update.bind(this))}this._processMousePosition(a);this.mMouseDown=true;if(this._mUserPauseEnabled&&this.pauseButton!==null&&this.mGameTime>0.5){if(Math.abs(this.mMouseX-this.pauseButton.x)<this.pauseButton.width/2&&Math.abs(this.mMouseY-this.pauseButton.y)<this.pauseButton.height/2){this.PauseGame(true);return}}this.stage._notifyObjectsOfMouseEvent("down",this.mMouseX,this.mMouseY);if(!this.mPaused){this.subclassMouseDown()}a.stopPropagation();a.preventDefault()},_mouseUp:function(a){this.mMouseDown=false;this.stage._notifyObjectsOfMouseEvent("up",this.mMouseX,this.mMouseY);if(!this.mPaused){this.subclassMouseUp()}a.stopPropagation();a.preventDefault()},_mouseMove:function(a){this._processMousePosition(a);this.stage._notifyObjectsOfMouseEvent("move",this.mMouseX,this.mMouseY);if(!this.mPaused){this.subclassMouseMove()}a.stopPropagation();a.preventDefault()},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},isMouseDown:function(){return this.mMouseDown},_keyDown:function(a){this.mKeysDown[a.keyCode]=true;this.stage._notifyObjectsOfKeyEvent("keydown",a.keyCode);this.subclassKeyDown(a.keyCode)},_keyUp:function(a){this.mKeysDown[a.keyCode]=false;this.stage._notifyObjectsOfKeyEvent("keyup",a.keyCode);this.subclassKeyUp(a.keyCode)},isKeyDown:function(a){return this.mKeysDown[a]===true},Width:function(){return this.stage.width},Height:function(){return this.stage.height},GameTime:function(){return this.mGameTime},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(a){return(this.stage.width/2)+(a-this.mCameraLocation.x)},ScreenY:function(a){return(this.stage.height/2)-(a-this.mCameraLocation.y)},GetImage:function(a){return this.assetManager.getImage(a)},OpenURL:function(a){TGE.Game.OpenURL(a)},PlayGame:function(){this.AnalyticGameEvent("begin");this.subclassPlayGame()},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(a){},subclassStartPlaying:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(a){},subclassEndGame:function(a){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},subclassKeyDown:function(a){},subclassKeyUp:function(a){},AnalyticGameEvent:function(a,b){if(this.analytics!==null){this.analytics.logGameEvent(a,this.mCurrentLevel,b)}},AnalyticShareEvent:function(a){if(this.analytics!==null){this.analytics.logShareEvent(a,this.mCurrentLevel)}},AnalyticLevelEvent:function(a){if(this.analytics!==null){this.analytics.logLevelEvent(a,this.mCurrentLevel,Math.floor(this.mGameTime))}},AnalyticAchievementEvent:function(b,a){if(this.analytics!==null){this.analytics.logAchievementEvent(b,this.mCurrentLevel,a)}},AnalyticErrorEvent:function(a){if(this.analytics!==null){this.analytics.logErrorEvent(a)}},AnalyticClickThruEvent:function(a){if(this.analytics!==null){this.analytics.logClickThruEvent(a,this.mCurrentLevel)}},AnalyticCustomEvent:function(a,b){if(this.analytics!==null){this.analytics.logCustomEvent(a,this.mCurrentLevel,b)}},ClearScene:function(){this.clearScene()},IsMouseDown:function(){return this.mMouseDown},CreateWorldEntity:function(b){var a=new b;b.prototype.constructor.apply(a,[this]);a.stage=this.stage;return a},CreateUIEntity:function(b){var a=new b;b.prototype.constructor.apply(a,[this]);a.stage=this.stage;return a},SetBackgroundColor:function(a){this.stage.backgroundColor=a}};TGE.KEY_ARROW_LEFT=37;TGE.KEY_ARROW_RIGHT=39;TGE.KEY_ARROW_UP=38;TGE.KEY_ARROW_DOWN=40;TGE.KEY_SPACEBAR=32;TGE.AssetLoader=function(){this.mAssetList=null;this.mUpdateCallback=null;this.mCompleteCallback=null;return this};TGE.AssetLoader.prototype={loadAssetList:function(o,g,d,c,l){if(g.list.length===0){if(c!==null){c(1)}if(l!==null){l.call()}return}if(!window.PxLoader){TGE.log("***** ERROR: The PxLoader libraries must be included to use TGE.AssetLoader");return}d=typeof d==="string"?d:"";if(d.length>0&&d.charAt(d.length-1)!=="/"){d=d.concat("/")}this.mAssetList=g;this.mUpdateCallback=c;this.mCompleteCallback=l;var n=new PxLoader({statusInterval:3000});var m=0;if(g!==null&&g.list.length>0&&g.loaded===false){for(i=0;i<g.list.length;i++){var e=!(g.list[i].absolutePath===true);var j=e?d:"";var h=null;if(g.list[i].assetType==="audio"){if(o.loadAudio){h=n.addAudio(g.list[i].id,j+g.list[i].url,j+g.list[i].backup_url,null,null);m++}}else{if(g.list[i].assetType==="audio_sprite"){h={assetType:"audio_sprite",id:g.list[i].sprite,startTime:g.list[i].startTime,endTime:g.list[i].endTime}}else{if(o.useSpriteSheets&&g.list[i].sheet){var b=g.list[i].sheet;var k=o._mSpriteSheets[b];if(!k){k=n.addImage(j+g.list[i].sheet);if(k!==null){o.addImage(g.list[i].id,k)}o._mSpriteSheets[g.list[i].sheet]=k}var f=TGE.AssetManager.SpriteSheets[this._trimmedFilename(b)];if(f){var a=f[this._trimmedFilename(g.list[i].url)];if(a){h={spriteSheet:k,x:a[0],y:a[1],width:a[2],height:a[3]}}}}else{h=n.addImage(j+g.list[i].url)}}}if(h!==null){o.addImage(g.list[i].id,h)}}n.addProgressListener(TGE.AssetLoader.prototype._loaderCallback.bind(this));n.addCompletionListener(TGE.AssetLoader.prototype._completeCallback.bind(this));n.start()}else{if(this.mUpdateCallback!==null){this.mUpdateCallback(1)}if(this.mCompleteCallback!==null){this.mCompleteCallback.call()}}},_trimmedFilename:function(a){var b=a.lastIndexOf("/")+1;return a.substr(b,a.lastIndexOf(".")-b)},_loaderCallback:function(b){if(b.error){TGE.log("***** ERROR: could not load image '"+b.resource.getName()+"'")}if(this.mUpdateCallback!==null){var a=b.completedCount/b.totalCount;this.mUpdateCallback(a)}},_completeCallback:function(){if(this.mAssetList!==null){this.mAssetList.loaded=true;this.mAssetList=null}if(this.mCompleteCallback!==null){this.mCompleteCallback()}}};TGE.AssetManager=function(a){if(TGE.AssetManager.sAssetManagerInstance!==null){return TGE.AssetManager.sAssetManagerInstance}TGE.AssetManager.sAssetManagerInstance=this;if(a===undefined){a=true}this.rootLocation=(window.GameConfig&&GameConfig.CDN_ROOT)?GameConfig.CDN_ROOT:"";this.useSpriteSheets=false;this.loadAudio=a;this._mSpriteSheets={};this.assignImageAssetList("loading",[]);this.assignImageAssetList("required",[]);return this};TGE.AssetManager.SpriteSheets={};TGE.AssetManager.sAssetManagerInstance=null;TGE.AssetManager.GetImage=function(a){return TGE.AssetManager.sAssetManagerInstance===null?null:TGE.AssetManager.sAssetManagerInstance.getImage(a)};TGE.AssetManager.prototype={_mImageAssetLists:[],_mImageCache:[],assignImageAssetList:function(b,a){this._mImageAssetLists[b]={loaded:false,list:a}},addAssets:function(b,a){if(!this._mImageAssetLists.hasOwnProperty(b)){this._mImageAssetLists[b]=[]}this._mImageAssetLists[b].list=this._mImageAssetLists[b].list.concat(a)},addAsset:function(a,b){if(!this._mImageAssetLists.hasOwnProperty(a)){this._mImageAssetLists[a]=[]}this._mImageAssetLists[a].list.push(b)},loadAssetList:function(b,d,c){var e=new TGE.AssetLoader();var a=this._mImageAssetLists[b];if(a){if(a.loaded===true){if(d){d.call(1)}if(c){c.call()}}else{e.loadAssetList(this,a,this.rootLocation,d,c)}}else{TGE.log("TGE.AssetManager could not locate asset list '"+b+"'");if(c){c.call()}}},addImage:function(b,a){this._mImageCache[b]=a},getImage:function(c,b){b=typeof b==="undefined"?true:b;var a=this._mImageCache[c];if(b&&c!=null&&!a){TGE.log("***** ERROR: TGE.AssetManager.getImage could not find the asset '"+c+"'")}return a}};TGE.Button=function(){TGE.Button.superclass.constructor.call(this);this.enabled=true;this.text="";this.idleColor=TGE.Button.DefaultIdleColor;this.hoverColor=TGE.Button.DefaultHoverColor;this.downColor=TGE.Button.DefaultDownColor;this.disableColor=TGE.Button.DefaultDisableColor;this.verticalPressOffset=TGE.Button.DefaultVerticalPressOffset;this._mState="idle";this._mMouseDown=false;this._mNumStates=1;this._mTextObject=null;this.addEventListener("mousedown",this._buttonMouseDown);this.addEventListener("mouseup",this._buttonMouseUp);this.addEventListener("click",this._onClick);this.addEventListener("update",this._update);this.pressFunction=null};TGE.Button.DefaultWidth=250;TGE.Button.DefaultHeight=60;TGE.Button.DefaultFont="bold 40px Arial";TGE.Button.DefaultTextColor="#000";TGE.Button.DefaultIdleColor="#ddd";TGE.Button.DefaultHoverColor="#ffc";TGE.Button.DefaultDownColor="#ccf";TGE.Button.DefaultDisableColor="#888";TGE.Button.DefaultVerticalPressOffset=0;TGE.Button.prototype={setup:function(c){TGE.Button.superclass.setup.call(this,c);typeof(c.numStates)==="number"?this._mNumStates=c.numStates:null;if(this._mNumStates>1&&typeof(c.image)!=="undefined"){this.setImage(c.image,1,this._mNumStates)}typeof(c.pressFunction)==="function"?this.pressFunction=c.pressFunction:null;typeof(c.text)==="string"?this.text=c.text:null;var a=typeof(c.font)==="string"?c.font:TGE.Button.DefaultFont;var b=typeof(c.textColor)==="string"?c.textColor:TGE.Button.DefaultTextColor;if(this.text!==null){this._mTextObject=this.addChild(new TGE.Text().setup({text:this.text,font:a,color:b}))}if(!c.image){this.width=typeof(c.width)==="number"?c.width:TGE.Button.DefaultWidth;this.height=typeof(c.height)==="number"?c.height:TGE.Button.DefaultHeight;this.idleColor=typeof(c.idleColor)==="string"?c.idleColor:TGE.Button.DefaultIdleColor;this.hoverColor=typeof(c.hoverColor)==="string"?c.hoverColor:TGE.Button.DefaultHoverColor;this.downColor=typeof(c.downColor)==="string"?c.downColor:TGE.Button.DefaultDownColor;this.disableColor=typeof(c.disableColor)==="string"?c.disableColor:TGE.Button.DefaultDisableColor;this.backgroundColor=this.idleColor}this.verticalPressOffset=typeof(c.verticalPressOffset)==="number"?c.verticalPressOffset:TGE.Button.DefaultVerticalPressOffset;typeof(c.enabled)==="boolean"?this.enabled=c.enabled:null;return this},_update:function(a){if(this._mTextObject!==null){this._mTextObject.text=this.text}if(!this.enabled){this._setButtonState("disable");return}if(this._mMouseOver){this._mMouseDown=TGE.Game.GetInstance().isMouseDown();this._setButtonState(this._mMouseDown?"down":"hover")}else{this._setButtonState("idle")}},_buttonMouseDown:function(a){this._mMouseDown=true},_buttonMouseUp:function(a){this._mMouseDown=false},_onClick:function(a){if(this.enabled&&this.pressFunction!==null){this.pressFunction.call(this,a.currentTarget)}},_setButtonState:function(b){if(b==this._mState){return}this._mState=b;if(this._mImage!==null){var a=0;switch(this._mState){case"disable":a=3;break;case"down":a=2;break;case"hover":a=1;break;case"idle":default:a=0;break}if(a<this._mNumStates){this.setSpriteIndex(a)}}else{switch(this._mState){case"disable":this.backgroundColor=this.disableColor;break;case"down":this.backgroundColor=this.downColor;break;case"hover":this.backgroundColor=this.hoverColor;break;case"idle":default:this.backgroundColor=this.idleColor;break}}},_draw:function(a){var b=this.verticalPressOffset>0&&this.mouseEnabled&&this.isMouseOver()&&this._mState==="down";if(b){this.y+=this.verticalPressOffset}TGE.Button.superclass._draw.call(this,a);if(b){this.y-=this.verticalPressOffset}}};extend(TGE.Button,TGE.Sprite);TGE.Text=function(){TGE.Text.superclass.constructor.call(this);this.text="";this.font="12px Arial";this.hAlign="center";this.vAlign="middle";this.textColor="#000";this._mPreviousText=null;this._mPreviousFont=null;return this};TGE.Text.prototype={setup:function(a){TGE.Text.superclass.setup.call(this,a);typeof(a.text)==="string"?this.text=a.text:null;typeof(a.font)==="string"?this.font=a.font:null;typeof(a.hAlign)==="string"?this.hAlign=a.hAlign:null;typeof(a.vAlign)==="string"?this.vAlign=a.vAlign:null;typeof(a.color)==="string"?this.textColor=a.color:null;return this},_calculateDimensions:function(b){b.save();b.font=this.font;var a=b.measureText(this.text);this.width=a.width;try{var f=this.font.indexOf("px");var c=this.font.substring(0,f).replace(/[^\d.]/g,"");this.height=parseInt(c,10);this.height+=(this.height/4)>>0}catch(d){this.height=30}b.restore()},_drawClass:function(a){if(this.text===null){return}if(this._mPreviousText!==this.text||this._mPreviousFont!==this.font){this._mPreviousText=this.text;this._mPreviousFont=this.font;this._calculateDimensions(a)}a.font=this.font!==null?this.font:"Arial";a.textAlign=this.hAlign!==null?this.hAlign:"center";a.textBaseline=this.vAlign!==null?this.vAlign:"middle";a.fillStyle=this.textColor!==null?this.textColor:"#000";a.fillText(this.text,0,0)}};extend(TGE.Text,TGE.DisplayObjectContainer);TGE.Analytics=function(a){this.gameName=a;return this};TGE.Analytics.prototype={logGameEvent:function(a,e,b){var d=this.gameName;if((a=="pause"||a=="resume")&&e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: game, "+a+", "+d;if(a=="load"||a=="end"){c+=(", "+b.toString())}TGE.log(c)},logShareEvent:function(a,d){var c=this.gameName;if(d!=null&&d>0){c+=(" - level "+d.toString())}var b="ANALYTIC EVENT: share, "+a+", "+c;TGE.log(b)},logLevelEvent:function(a,e,b){var d=this.gameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: level, "+a+", "+d;if((a=="complete"||a=="fail")&&b!=null){c+=(", "+b.toString())}TGE.log(c)},logAchievementEvent:function(b,e,a){var d=this.gameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: achievement, "+b+", "+d;if(a!=null){c+=(", "+a.toString())}TGE.log(c)},logErrorEvent:function(b){var a="ANALYTIC EVENT: error, "+b+", "+this.gameName;TGE.log(a)},logClickThruEvent:function(a,d){var c=this.gameName;if(d!=null&&d>0){c+=(" - level "+d.toString())}var b="ANALYTIC EVENT: clickthru, "+a+", "+c;TGE.log(b)},logCustomEvent:function(a,e,b){var d=this.gameName;if(e!=null&&e>0){d+=(" - level "+e.toString())}var c="ANALYTIC EVENT: custom, "+a+", "+d;if(b!=null){c+=(", "+b.toString())}TGE.log(c)}};TGE.GoogleAnalytics=function(a,b){TGE.GoogleAnalytics.superclass.constructor.call(this,a);if(TGE.BrowserDetect.usingPhoneGap){if(window.plugins&&window.plugins.gaPlugin){this._gaPlugin=window.plugins.gaPlugin;this._gaPlugin.init(null,this._logError,b,10)}else{TGE.log("***** ERROR: PhoneGap GoogleAnalytics plugin was not found")}}return this};TGE.GoogleAnalytics.prototype={_gaPlugin:null,logGameEvent:function(g,a,j){try{var d=this.gameName;if((g=="pause"||g=="resume")&&a!=null&&a>0){d+=(" - level "+a.toString())}var k="game";var f=g;var b=d;var c=j;this._trackEvent(k,f,b,c)}catch(h){this._logError(h.toString())}},logShareEvent:function(b,j){try{var g=this.gameName;if(j!=null&&j>0){g+=(" - level "+j.toString())}var a="share";var f=b;var c=g;var h=null;this._trackEvent(a,f,c,h)}catch(d){this._logError(d.toString())}},logLevelEvent:function(h,a,f){try{var d=this.gameName;if(a!=null&&a>0){d+=(" - level "+a.toString())}var k="level";var g=h;var b=d;var c;if(h=="complete"||h=="fail"&&f!=null){c=f}this._trackEvent(k,g,b,c)}catch(j){this._logError(j.toString())}},logAchievementEvent:function(d,a,j){try{var f=this.gameName;if(a!=null&&a>0){f+=(" - level "+a.toString())}var k="achievement";var g=d;var b=f;var c=j;this._trackEvent(k,g,b,c)}catch(h){this._logError(h.toString())}},logErrorEvent:function(g){try{var a="error";var d=g;var b=this.gameName;var f=null;this._trackEvent(a,d,b,f)}catch(c){this._logError(c.toString())}},logClickThruEvent:function(b,j){try{var g=this.gameName;if(j!=null&&j>0){g+=(" - level "+j.toString())}var a="clickthru";var f=b;var c=g;var h=null;this._trackEvent(a,f,c,h)}catch(d){this._logError(d.toString())}},logCustomEvent:function(g,a,j){try{var d=this.gameName;if(a!=null&&a>0){d+=(" - level "+a.toString())}var k="custom";var f=g;var b=d;var c=j;this._trackEvent(k,f,b,c)}catch(h){this._logError(h.toString())}},_trackEvent:function(a,c,b,d){if(this._gaPlugin!==null){if(typeof d!=="number"){d=-1}this._gaPlugin.trackEvent(this._logResult,this._logError,a,c,b,d)}else{if(_gaq){_gaq.push(["_trackEvent",a,c,b,d])}}},_logError:function(a){TGE.log("***** ERROR: TGE.GoogleAnalytics - "+a)},_logResult:function(a){}};extend(TGE.GoogleAnalytics,TGE.Analytics);TGE.ParallaxPane=function(){TGE.ParallaxPane.superclass.constructor.call(this);this.trackingSpeed=1;this.offset=0;this.scrollVertically=false;this.horizontalOffset=0;this.horizontalSpacing=0;this.verticalOffset=0;this.verticalSpacing=0;this._mPane1=null;this._mPane2=null;this.addEventListener("camerachange",this._updateToCamera)};TGE.ParallaxPane.prototype={setup:function(b){TGE.ParallaxPane.superclass.setup.call(this,b);var a=typeof(b.image)!=="undefined"?b.image:null;this.trackingSpeed=typeof(b.trackingSpeed)==="number"?b.trackingSpeed:1;this.scrollVertically=typeof(b.vertical)==="boolean"?b.vertical:false;this.horizontalOffset=typeof(b.horizontalOffset)==="number"?b.horizontalOffset:0;this.horizontalSpacing=typeof(b.horizontalSpacing)==="number"?b.horizontalSpacing:0;this.verticalOffset=typeof(b.verticalOffset)==="number"?b.verticalOffset:0;this.verticalSpacing=typeof(b.verticalSpacing)==="number"?b.verticalSpacing:0;this.registrationX=0;this.registrationY=0;this._mPane1=new TGE.Sprite();this._mPane1.setImage(a);this._mPane1.registrationX=0;this._mPane1.registrationY=0;this.addChild(this._mPane1);this._mPane2=new TGE.Sprite();this._mPane2.setImage(a);this._mPane2.registrationX=0;this._mPane2.registrationY=0;this.addChild(this._mPane2);return this},_updateToCamera:function(g){if(this.scrollVertically){var d=g.cy;var b=(this.verticalOffset/this.scaleY)+(d+this.offset)*this.trackingSpeed/this.scaleY;var a=(this.stage.height+this.verticalSpacing)/this.scaleY;this._mPane1.x=0;this._mPane1.y=b%a;this._mPane2.x=0;this._mPane2.y=this._mPane1.y-a}else{var f=g.cx;var c=(this.horizontalOffset/this.scaleX)+(-f+this.offset)*this.trackingSpeed/this.scaleX;var e=(this.stage.width+this.horizontalSpacing)/this.scaleX;this._mPane1.x=(c%e);this._mPane1.y=(this.stage.height/2)-(this.worldY-g.cy);this._mPane2.x=this._mPane1.x+e;this._mPane2.y=this._mPane1.y}}};extend(TGE.ParallaxPane,TGE.DisplayObjectContainer);TGE.Advertisement=function(a){this.element=a.element==="undefined"?null:a.element;this.closeCallback=a.closeCallback==="undefined"?null:a.closeCallback};TGE.Advertisement.prototype={close:function(){if(this.element!==null&&this.element.parentNode!==null){this.element.parentNode.removeChild(this.element)}if(this.closeCallback!==null){this.closeCallback.call()}}};TGE.Advertisement.DisplayAd=function(f){var a=f.parentDiv;var d=f.adWidth;var m=f.adHeight;var j=typeof f.x==="undefined"?(a.clientWidth-d)/2:f.x;var h=typeof f.y==="undefined"?(a.clientHeight-m)/2:f.y;var c=typeof f.closeCallback==="undefined"?null:f.closeCallback;var l=null;if(getDistributionPartner()==="A0009"){l=null}else{var e=TGE.Game.GetInstance()._mDivResized?TGE.Game.GetInstance()._mViewportScale:1;l=document.createElement("div");l.style.position="absolute";l.style.zIndex=3;l.style.left=(j*e).toString()+"px";l.style.top=(h*e).toString()+"px";l.style.width=d.toString()+"px";l.style.height=m.toString()+"px";l.style.overflow="hidden";l.style.border="none";if(TGE.Game.GetInstance()._mDivResized){var b=l.getAttribute("style")||"";l.setAttribute("style",b+" -ms-transform-origin: 0% 0%; -webkit-transform-origin: 0% 0%; -moz-transform-origin: 0% 0%; -o-transform-origin: 0% 0%; transform-origin: 0% 0%; -ms-transform: scale("+e+"); -webkit-transform: scale("+e+"); -moz-transform: scale("+e+"); -o-transform: scale("+e+"); transform: scale("+e+");")}a.insertBefore(l,a.firstChild);if(getDistributionPartner()==="A0021"){l.innerHTML="<iframe src='http://games.tresensa.com/ad/index.html' width='300' height='250'></iframe>"}else{if(GameConfig.ADS.SERVER==="adx"){window.google_ad_client="ca-pub-7652406314619998";window.google_ad_slot=GameConfig.ADS.GAMEOVER_PLACEMENT_ID;window.google_ad_width=300;window.google_ad_height=250;var k=document.write;document.write=function(n){l.innerHTML=n;document.write=k};var g=document.createElement("script");g.type="text/javascript";g.src="http://pagead2.googlesyndication.com/pagead/show_ads.js";document.body.appendChild(g)}else{l.innerHTML="<object type='text/html' width='"+d+"px' height='"+(m+4).toString()+"px' data='"+f.adURL+"'></object>"}}}return new TGE.Advertisement({element:l,closeCallback:c})};TGE.Advertisement.DisplayModalOverlayAd=function(e){var f=e.parentDiv;var q=e.adWidth;var s=e.adHeight;var g=typeof e.skipDelay==="undefined"?0:e.skipDelay;var h=typeof e.headerText==="undefined"?"This game sponsored by:":e.headerText;var j=typeof e.overlayRed==="undefined"?1:e.overlayRed;var t=typeof e.overlayGreen==="undefined"?1:e.overlayGreen;var p=typeof e.overlayBlue==="undefined"?1:e.overlayBlue;var o=typeof e.overlayOpacity==="undefined"?1:e.overlayOpacity;var d=typeof e.closeCallback==="undefined"?null:e.closeCallback;if(getDistributionPartner()==="A0009"){if(d!==null){d.call()}return}var m=document.createElement("div");m.id="ad_overlay";m.style.zIndex=3;m.style.position="absolute";m.style.width=f.clientWidth+"px";m.style.height=f.clientHeight+"px";m.style.backgroundColor="rgba("+Math.round(j*255).toString()+","+Math.round(t*255).toString()+","+Math.round(p*255).toString()+","+o.toString()+")";f.insertBefore(m,f.firstChild);var r=null;if(typeof e.closeButton==="string"){var b=30;r=document.createElement("div");r.id="tge_ad_close_button";r.style.position="absolute";r.style.display="none";var k=Math.round(f.clientWidth*0.0156);var c=f.clientWidth-k-b;r.style.top=k.toString()+"px";r.style.left=c.toString()+"px";r.innerHTML="<img src='"+e.closeButton+"'>";r.style.cursor="pointer";m.insertBefore(r,m.firstChild)}var b=30;var n=document.createElement("div");n.id="tge_ad_resume_button";n.style.position="absolute";n.style.display="none";var k=Math.round(f.clientHeight*0.904);var c=(f.clientWidth-(300+2))/2;n.style.top=k.toString()+"px";n.style.left=c.toString()+"px";n.style.width="300px";n.style.marginLeft="auto";n.style.marginRight="auto";n.style.textAlign="center";n.style.paddingTop="6px";n.style.paddingBottom="6px";n.style.backgroundColor="#f00";n.style.border="solid 1px #444";n.style.borderRadius="5px";n.style.color="#fff";n.style.fontSize="17px";n.style.fontWeight="bold";n.innerHTML="Resume Game Play";n.style.cursor="pointer";m.insertBefore(n,m.firstChild);var a=!TGE.BrowserDetect.isMobileDevice||TGE.BrowserDetect.onWindowsMobile?"click":"touchstart";if(r!==null){r.addEventListener(a,TGE.Advertisement._CloseAd.bind(this,m,d),false)}n.addEventListener(a,TGE.Advertisement._CloseAd.bind(this,m,d),false);if(g>0){setTimeout(TGE.Advertisement._ShowOverlayCloseButtons.bind(this,m),g*1000)}else{TGE.Advertisement._ShowOverlayCloseButtons(m)}m.addEventListener("click",TGE.Advertisement._BlockEvent,false);m.addEventListener("mousedown",TGE.Advertisement._BlockEvent,false);m.addEventListener("mouseup",TGE.Advertisement._BlockEvent,false);m.addEventListener("mousemove",TGE.Advertisement._BlockEvent,false);var l=document.createElement("div");l.id="ad_div";l.style.position="absolute";var k=(f.clientHeight-(s+70))/2;l.style.top=k.toString()+"px";l.style.marginLeft="auto";l.style.marginRight="auto";l.style.width="100%";l.style.overflow="hidden";l.style.color="#333";l.style.fontSize="20px";l.style.fontWeight="bold";l.style.textAlign="center";m.insertBefore(l,m.firstChild);l.innerHTML="<div style='padding-bottom: 15px;'>"+h+"</div><object type='text/html' width='"+q+"px' height='"+(s+4).toString()+"px' data='"+e.adURL+"'></object><div style='color: #666; font-size: 10px; font-weight: normal; padding-left: "+(q-72).toString()+"px;'>Advertisement</div>"};TGE.Advertisement.DisplayChildBrowserAd=function(a){window.plugins.childBrowser.onClose=a.closeCallback;window.plugins.childBrowser.showWebPage(a.adURL,{showLocationBar:true,showAddress:false,showNavigationBar:true})};TGE.Advertisement._CloseAd=function(a,c,b){a.parentNode.removeChild(a);TGE.Advertisement._removejscssfile("http://pagead2.googlesyndication.com/pagead/show_ads.js","js");if(c!==null){c.call()}};TGE.Advertisement._ShowOverlayCloseButtons=function(b){var a=document.getElementById("tge_ad_close_button");if(a!=null){a.style.display="block"}var c=document.getElementById("tge_ad_resume_button");if(c!=null){c.style.display="block"}};TGE.Advertisement._BlockEvent=function(a){a.stopPropagation();a.preventDefault();a.stopImmediatePropagation();return false};TGE.Advertisement._removejscssfile=function(a,c){var e=(c=="js")?"script":(c=="css")?"link":"none";var d=(c=="js")?"src":(c=="css")?"href":"none";var f=document.getElementsByTagName(e);for(var b=f.length;b>=0;b--){if(f[b]&&f[b].getAttribute(d)!=null&&f[b].getAttribute(d).indexOf(a)!=-1){f[b].parentNode.removeChild(f[b])}}};TGE.PlatformCompatibility=function(){return this};TGE.PlatformCompatibility.prototype={isAudioSupported:function(){var b=document.createElement("audio"),a=false;try{if(a=!!b.canPlayType){a=new Boolean(a);a.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");a.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,"");a.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");a.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(c){}return a},isAudioFormatSupported:function(a){var d=document.createElement("audio"),b=false;var c;try{if(b=!!d.canPlayType){b=new Boolean(b);switch(a){case"ogg":c=d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");break;case"mp3":c=d.canPlayType("audio/mpeg;").replace(/^no$/,"");break;case"wav":c=d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");break;case"m4a":c=(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,"");break;default:break}}}catch(f){}return c},isCanvasSupported:function(){var a=document.createElement("canvas");return !!(a.getContext&&a.getContext("2d"))},isVideoSupported:function(){var b=document.createElement("video"),a=false;try{if(a=!!b.canPlayType){a=new Boolean(a);a.ogg=b.canPlayType('video/ogg; codecs="theora"');a.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"');a.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"')}}catch(c){}return a},isDragAndDropSupported:function(){var a=document.createElement("div");bool=("draggable" in a)||("ondragstart" in a&&"ondrop" in a);return bool},isGeolocationSupported:function(){return !!navigator.geolocation},isWebGlSupported:function(){try{var b=document.createElement("canvas"),a;a=!!(window.WebGLRenderingContext&&(b.getContext("experimental-webgl")||b.getContext("webgl")));b=undefined}catch(c){a=false}return a},isHistorySupported:function(){return !!(window.history&&history.pushState)},isVideoSupported:function(){var b=document.createElement("video"),a=false},isLocalStorageSupported:function(){try{localStorage.setItem(mod,mod);localStorage.removeItem(mod);return true}catch(a){return false}},isSessionStorageSupported:function(){try{sessionStorage.setItem(mod,mod);sessionStorage.removeItem(mod);return true}catch(a){return false}},isSVGSupported:function(){ns={svg:"http://www.w3.org/2000/svg"};return !!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect}};TGE.DeviceOrientation=function(){return this};TGE.DeviceOrientation.prototype={orientationChangeCallBack:null,RegisterOrientationChange:function(a){TGE.DeviceOrientation.prototype.orientationChangeCallBack=a;window.addEventListener("orientationchange",TGE.DeviceOrientation.prototype.internalOrientationChanged);TGE.DeviceOrientation.prototype.internalOrientationChanged()},internalOrientationChanged:function(){if(window.orientation===90||window.orientation===-90){TGE.DeviceOrientation.prototype.orientationChangeCallBack("landscape")}else{TGE.DeviceOrientation.prototype.orientationChangeCallBack("portrait")}}};var Sha1={};Sha1.hash=function(h,z){z=(typeof z=="undefined")?true:z;if(z){h=Utf8.encode(h)}var n=[1518500249,1859775393,2400959708,3395469782];h+=String.fromCharCode(128);var x=h.length/4+2;var k=Math.ceil(x/16);var m=new Array(k);for(var A=0;A<k;A++){m[A]=new Array(16);for(var y=0;y<16;y++){m[A][y]=(h.charCodeAt(A*64+y*4)<<24)|(h.charCodeAt(A*64+y*4+1)<<16)|(h.charCodeAt(A*64+y*4+2)<<8)|(h.charCodeAt(A*64+y*4+3))}}m[k-1][14]=((h.length-1)*8)/Math.pow(2,32);m[k-1][14]=Math.floor(m[k-1][14]);m[k-1][15]=((h.length-1)*8)&4294967295;var u=1732584193;var r=4023233417;var q=2562383102;var p=271733878;var o=3285377520;var f=new Array(80);var F,E,D,C,B;for(var A=0;A<k;A++){for(var v=0;v<16;v++){f[v]=m[A][v]}for(var v=16;v<80;v++){f[v]=Sha1.ROTL(f[v-3]^f[v-8]^f[v-14]^f[v-16],1)}F=u;E=r;D=q;C=p;B=o;for(var v=0;v<80;v++){var w=Math.floor(v/20);var g=(Sha1.ROTL(F,5)+Sha1.f(w,E,D,C)+B+n[w]+f[v])&4294967295;B=C;C=D;D=Sha1.ROTL(E,30);E=F;F=g}u=(u+F)&4294967295;r=(r+E)&4294967295;q=(q+D)&4294967295;p=(p+C)&4294967295;o=(o+B)&4294967295}return Sha1.toHexStr(u)+Sha1.toHexStr(r)+Sha1.toHexStr(q)+Sha1.toHexStr(p)+Sha1.toHexStr(o)};Sha1.f=function(b,a,d,c){switch(b){case 0:return(a&d)^(~a&c);case 1:return a^d^c;case 2:return(a&d)^(a&c)^(d&c);case 3:return a^d^c}};Sha1.ROTL=function(a,b){return(a<<b)|(a>>>(32-b))};Sha1.toHexStr=function(d){var c="",a;for(var b=7;b>=0;b--){a=(d>>>(b*4))&15;c+=a.toString(16)}return c};var Utf8={};Utf8.encode=function(a){var b=a.replace(/[\u0080-\u07ff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(192|d>>6,128|d&63)});b=b.replace(/[\u0800-\uffff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(224|d>>12,128|d>>6&63,128|d&63)});return b};Utf8.decode=function(b){var a=b.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var d=((e.charCodeAt(0)&15)<<12)|((e.charCodeAt(1)&63)<<6)|(e.charCodeAt(2)&63);return String.fromCharCode(d)});a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var d=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(d)});return a};